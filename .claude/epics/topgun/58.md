---
name: Integrate Swagger UI for interactive API explorer
status: open
created: 2025-10-06T15:23:47Z
updated: 2025-10-06T20:39:12Z
github: https://github.com/johnproblems/topgun/issues/166
depends_on: [57]
parallel: false
conflicts_with: []
---

# Task: Integrate Swagger UI for interactive API explorer

## Description

Integrate **Swagger UI** (OpenAPI UI) to provide an interactive, web-based API documentation and testing interface for the Coolify Enterprise API. This task builds upon the enhanced OpenAPI specification created in Task 57, providing developers with a beautiful, user-friendly interface to explore endpoints, test API calls, and understand request/response schemas without leaving their browser.

Modern API platforms require more than static documentation‚Äîdevelopers need to:
1. **Explore APIs interactively** - Browse endpoints, view parameters, understand schemas
2. **Test endpoints in real-time** - Execute API calls directly from the browser with authentication
3. **Understand authentication flows** - Test token-based auth and organization scoping
4. **View examples** - See sample requests and responses with realistic data
5. **Debug API calls** - Inspect request headers, response codes, and error messages

This implementation creates a comprehensive Swagger UI integration that:
- Serves the interactive Swagger UI interface at `/api/docs`
- Loads the OpenAPI specification from Task 57 (`/api/openapi.yaml`)
- Provides **organization-scoped authentication** for testing API calls
- Supports **multiple authentication methods** (Bearer tokens, API keys)
- Includes **"Try it out" functionality** for all endpoints
- Displays organization context and rate limiting information
- Provides deep linking to specific endpoints
- Integrates with Laravel's existing routing and authentication systems

**Integration with Enterprise Architecture:**
- Uses the enhanced OpenAPI spec from Task 57 with organization scoping examples
- Integrates with Laravel Sanctum authentication for token-based testing
- Respects rate limiting middleware (Task 54) when testing endpoints
- Displays organization context from ApiOrganizationScope middleware (Task 53)
- Works seamlessly with all enterprise API endpoints (Tasks 56)
- Provides a gateway for developers to understand the multi-tenant API design

**Why this task is important:** Static API documentation is insufficient for modern developers. Swagger UI transforms our OpenAPI specification into an interactive playground where developers can learn, test, and debug API integrations in real-time. This dramatically reduces integration time, improves developer experience, and serves as both documentation and a debugging tool. For enterprise customers integrating with Coolify's API, Swagger UI is the difference between a frustrating integration process and a delightful one‚Äîit's the front door to our entire API ecosystem.

**Business Impact:**
- Reduces API integration time by 50-70% (developers can test without writing code)
- Decreases support tickets related to API usage and authentication
- Improves API adoption among enterprise customers
- Serves as living documentation that always matches the codebase
- Enables non-technical stakeholders to understand API capabilities

## Acceptance Criteria

- [ ] Swagger UI accessible at `/api/docs` route (public access for documentation browsing)
- [ ] Swagger UI loads OpenAPI specification from `/api/openapi.yaml` endpoint
- [ ] "Try it out" functionality works for all API endpoints with authentication
- [ ] Organization-scoped authentication working (Bearer token input with org selection)
- [ ] Rate limiting information displayed in UI (current limits, remaining requests)
- [ ] Deep linking to specific endpoints functional (e.g., `/api/docs#/organizations/listOrganizations`)
- [ ] Request/response examples displayed for all endpoints
- [ ] Schema definitions displayed with organization scoping annotations
- [ ] Authentication modal with clear instructions for obtaining tokens
- [ ] Error handling displays helpful messages for 401, 403, 429, 500 errors
- [ ] Responsive design works on desktop, tablet, and mobile
- [ ] Dark mode support matching Coolify's existing theme
- [ ] Search functionality for filtering endpoints
- [ ] Swagger UI version >= 5.0 for latest features
- [ ] Custom branding with Coolify Enterprise logo (can be white-labeled)

## Technical Details

### File Paths

**Controller:**
- `/home/topgun/topgun/app/Http/Controllers/Api/ApiDocumentationController.php` (new)

**Routes:**
- `/home/topgun/topgun/routes/api.php` - Add routes for Swagger UI and OpenAPI spec

**Views (Blade template for Swagger UI):**
- `/home/topgun/topgun/resources/views/api/swagger-ui.blade.php` (new)

**Public Assets:**
- `/home/topgun/topgun/public/vendor/swagger-ui/` - Swagger UI static assets (CSS, JS)
- Alternatively, use CDN for Swagger UI assets

**Configuration:**
- `/home/topgun/topgun/config/api.php` - API documentation configuration

### Dependencies

**NPM Packages (if self-hosting assets):**
```bash
npm install swagger-ui-dist --save
```

**OR use CDN:**
- `https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.10.0/swagger-ui-bundle.js`
- `https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.10.0/swagger-ui.css`

**Existing Laravel Components:**
- OpenAPI specification from Task 57 (`OpenApiController`)
- Laravel Sanctum for API authentication
- ApiOrganizationScope middleware from Task 53
- Rate limiting middleware from Task 54

### Controller Implementation

**File:** `app/Http/Controllers/Api/ApiDocumentationController.php`

```php
<?php

namespace App\Http\Controllers\Api;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\File;
use Illuminate\Support\Facades\Response;

class ApiDocumentationController extends Controller
{
    /**
     * Display the Swagger UI interface
     *
     * @return \Illuminate\View\View
     */
    public function index()
    {
        return view('api.swagger-ui', [
            'title' => config('api.documentation.title', 'Coolify Enterprise API Documentation'),
            'description' => config('api.documentation.description'),
            'specUrl' => route('api.openapi.spec'),
            'authUrl' => route('api.auth.token'),
            'version' => config('api.version', '1.0.0'),
        ]);
    }

    /**
     * Serve custom Swagger UI configuration
     *
     * @return \Illuminate\Http\JsonResponse
     */
    public function config()
    {
        return response()->json([
            'urls' => [
                [
                    'name' => 'Coolify Enterprise API v1',
                    'url' => route('api.openapi.spec'),
                ],
            ],
            'deepLinking' => true,
            'displayOperationId' => false,
            'defaultModelsExpandDepth' => 3,
            'defaultModelExpandDepth' => 3,
            'displayRequestDuration' => true,
            'docExpansion' => 'list', // 'list', 'full', 'none'
            'filter' => true,
            'showExtensions' => true,
            'showCommonExtensions' => true,
            'tryItOutEnabled' => true,
            'requestSnippetsEnabled' => true,
            'persistAuthorization' => true,
            'layout' => 'BaseLayout',
            'validatorUrl' => null, // Disable online validator
            'supportedSubmitMethods' => ['get', 'post', 'put', 'delete', 'patch', 'options'],
            'presets' => [
                'apis',
            ],
            'plugins' => [
                'DownloadUrl',
            ],
        ]);
    }

    /**
     * Serve authentication instructions
     *
     * @return \Illuminate\Http\JsonResponse
     */
    public function authInstructions()
    {
        return response()->json([
            'message' => 'To test API endpoints, you need a valid Sanctum token.',
            'steps' => [
                '1. Log in to your Coolify Enterprise account',
                '2. Navigate to Settings > API Keys',
                '3. Create a new API key with the required scopes',
                '4. Copy the generated token',
                '5. Click the "Authorize" button in Swagger UI',
                '6. Paste your token in the "Bearer" field',
                '7. Click "Authorize" to save',
            ],
            'note' => 'Tokens are organization-scoped. Ensure you have access to the organization you are testing.',
            'documentation' => route('api.docs.authentication'),
        ]);
    }

    /**
     * Redirect legacy /api/documentation to new /api/docs
     *
     * @return \Illuminate\Http\RedirectResponse
     */
    public function legacyRedirect()
    {
        return redirect()->route('api.docs.index');
    }
}
```

### Blade Template for Swagger UI

**File:** `resources/views/api/swagger-ui.blade.php`

```blade
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{{ $title ?? 'API Documentation' }}</title>

    <!-- Swagger UI CSS (CDN) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.10.0/swagger-ui.css">

    <!-- Custom Styles -->
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        .swagger-ui .topbar {
            background-color: #1a202c; /* Coolify dark theme */
            padding: 10px 0;
        }

        .swagger-ui .topbar .wrapper {
            max-width: 1460px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .swagger-ui .topbar .topbar-wrapper img {
            height: 40px;
        }

        .swagger-ui .info {
            margin: 50px 0;
        }

        .swagger-ui .info .title {
            font-size: 36px;
            font-weight: 700;
            color: #1a202c;
        }

        .swagger-ui .scheme-container {
            background: #fafafa;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.15);
            margin: 0 0 20px 0;
            padding: 30px 0;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a202c;
            }

            .swagger-ui .topbar {
                background-color: #2d3748;
            }

            .swagger-ui {
                filter: invert(88%) hue-rotate(180deg);
            }

            .swagger-ui img {
                filter: invert(100%) hue-rotate(180deg);
            }
        }

        /* Custom authorization banner */
        .auth-banner {
            background-color: #edf2f7;
            border-left: 4px solid #4299e1;
            padding: 16px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .auth-banner h3 {
            margin-top: 0;
            color: #2d3748;
        }

        .auth-banner p {
            margin-bottom: 8px;
            color: #4a5568;
        }

        .auth-banner code {
            background-color: #2d3748;
            color: #f7fafc;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Custom Authentication Banner -->
    <div id="auth-banner" class="auth-banner" style="max-width: 1460px; margin: 20px auto;">
        <h3>üîê Authentication Required</h3>
        <p>
            To test API endpoints, click the <strong>"Authorize"</strong> button and enter your Sanctum token.
        </p>
        <p>
            <strong>How to get a token:</strong>
            Navigate to <code>Settings ‚Üí API Keys</code> in your Coolify dashboard and create a new token with the required scopes.
        </p>
        <p>
            <strong>Organization Context:</strong> All API requests are scoped to the organization associated with your token.
        </p>
    </div>

    <!-- Swagger UI Container -->
    <div id="swagger-ui"></div>

    <!-- Swagger UI Bundle (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.10.0/swagger-ui-bundle.js" charset="UTF-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.10.0/swagger-ui-standalone-preset.js" charset="UTF-8"></script>

    <!-- Swagger UI Initialization -->
    <script>
        window.onload = function() {
            const ui = SwaggerUIBundle({
                url: "{{ $specUrl }}",
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIStandalonePreset
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                layout: "StandaloneLayout",
                defaultModelsExpandDepth: 3,
                defaultModelExpandDepth: 3,
                displayRequestDuration: true,
                docExpansion: 'list',
                filter: true,
                showExtensions: true,
                showCommonExtensions: true,
                tryItOutEnabled: true,
                requestSnippetsEnabled: true,
                persistAuthorization: true,
                validatorUrl: null,
                supportedSubmitMethods: ['get', 'post', 'put', 'delete', 'patch', 'options', 'head'],

                // Custom request interceptor to add organization context
                requestInterceptor: function(req) {
                    // Add custom headers for organization context
                    if (req.headers.Authorization) {
                        req.headers['X-Organization-Context'] = 'enabled';
                    }

                    // Add CSRF token if available
                    const csrfToken = document.querySelector('meta[name="csrf-token"]');
                    if (csrfToken) {
                        req.headers['X-CSRF-TOKEN'] = csrfToken.getAttribute('content');
                    }

                    return req;
                },

                // Custom response interceptor for better error handling
                responseInterceptor: function(res) {
                    // Display rate limit information
                    if (res.headers['x-ratelimit-limit']) {
                        console.log('Rate Limit:', {
                            limit: res.headers['x-ratelimit-limit'],
                            remaining: res.headers['x-ratelimit-remaining'],
                            reset: res.headers['x-ratelimit-reset']
                        });
                    }

                    // Handle 429 Too Many Requests
                    if (res.status === 429) {
                        const retryAfter = res.headers['retry-after'];
                        alert(`Rate limit exceeded. Please retry after ${retryAfter} seconds.`);
                    }

                    // Handle 401 Unauthorized
                    if (res.status === 401) {
                        console.warn('Authentication required. Please authorize with a valid token.');
                    }

                    // Handle 403 Forbidden
                    if (res.status === 403) {
                        console.warn('Access forbidden. Check your organization permissions.');
                    }

                    return res;
                },

                // OAuth2 configuration (if using OAuth2 in the future)
                oauth2RedirectUrl: window.location.origin + '/api/docs/oauth2-redirect.html',

                // Custom plugin to hide auth banner after authorization
                onComplete: function() {
                    // Listen for authorization events
                    const authorizeBtn = document.querySelector('.authorize');
                    if (authorizeBtn) {
                        authorizeBtn.addEventListener('click', function() {
                            setTimeout(function() {
                                const authBanner = document.getElementById('auth-banner');
                                if (authBanner) {
                                    authBanner.style.display = 'none';
                                }
                            }, 500);
                        });
                    }
                }
            });

            window.ui = ui;
        };
    </script>
</body>
</html>
```

### Routes Configuration

**File:** `routes/api.php`

```php
<?php

use App\Http\Controllers\Api\ApiDocumentationController;
use App\Http\Controllers\Api\OpenApiController;

// API Documentation Routes (public access)
Route::prefix('docs')->name('api.docs.')->group(function () {
    // Main Swagger UI interface
    Route::get('/', [ApiDocumentationController::class, 'index'])
        ->name('index');

    // Swagger UI configuration
    Route::get('/config', [ApiDocumentationController::class, 'config'])
        ->name('config');

    // Authentication instructions
    Route::get('/auth-instructions', [ApiDocumentationController::class, 'authInstructions'])
        ->name('auth.instructions');

    // Legacy redirect for old documentation URLs
    Route::get('/documentation', [ApiDocumentationController::class, 'legacyRedirect'])
        ->name('legacy.redirect');
});

// OpenAPI Specification (from Task 57)
Route::get('/openapi.yaml', [OpenApiController::class, 'yaml'])
    ->name('api.openapi.spec');

Route::get('/openapi.json', [OpenApiController::class, 'json'])
    ->name('api.openapi.json');
```

### Configuration File

**File:** `config/api.php`

```php
<?php

return [
    /*
    |--------------------------------------------------------------------------
    | API Version
    |--------------------------------------------------------------------------
    |
    | The current version of the API. This is displayed in Swagger UI and
    | used in API endpoints.
    |
    */
    'version' => env('API_VERSION', '1.0.0'),

    /*
    |--------------------------------------------------------------------------
    | API Documentation
    |--------------------------------------------------------------------------
    |
    | Configuration for API documentation and Swagger UI.
    |
    */
    'documentation' => [
        'title' => env('API_DOCS_TITLE', 'Coolify Enterprise API'),
        'description' => env('API_DOCS_DESCRIPTION', 'Comprehensive API for managing applications, servers, and infrastructure in Coolify Enterprise.'),
        'contact_email' => env('API_CONTACT_EMAIL', 'support@coolify.io'),
        'license' => 'Proprietary',
        'license_url' => 'https://coolify.io/license',

        // Swagger UI configuration
        'swagger_ui' => [
            'enabled' => env('API_DOCS_ENABLED', true),
            'cdn_version' => '5.10.0',
            'use_cdn' => env('SWAGGER_UI_USE_CDN', true),
            'deep_linking' => true,
            'display_operation_id' => false,
            'default_models_expand_depth' => 3,
            'default_model_expand_depth' => 3,
            'doc_expansion' => 'list', // 'list', 'full', 'none'
            'filter' => true,
            'show_extensions' => true,
            'show_common_extensions' => true,
            'persist_authorization' => true,
        ],

        // Authentication information
        'authentication' => [
            'type' => 'Bearer',
            'scheme' => 'Bearer',
            'bearer_format' => 'Sanctum Token',
            'description' => 'Use a Sanctum API token from Settings > API Keys. All requests are scoped to your organization.',
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | OpenAPI Specification
    |--------------------------------------------------------------------------
    |
    | Configuration for OpenAPI specification generation.
    |
    */
    'openapi' => [
        'version' => '3.0.0',
        'info' => [
            'title' => env('API_DOCS_TITLE', 'Coolify Enterprise API'),
            'version' => env('API_VERSION', '1.0.0'),
            'description' => env('API_DOCS_DESCRIPTION'),
            'contact' => [
                'name' => 'Coolify Support',
                'email' => env('API_CONTACT_EMAIL', 'support@coolify.io'),
                'url' => 'https://coolify.io/support',
            ],
            'license' => [
                'name' => 'Proprietary',
                'url' => 'https://coolify.io/license',
            ],
        ],

        'servers' => [
            [
                'url' => env('APP_URL', 'https://api.coolify.io') . '/api',
                'description' => 'Production API Server',
            ],
            [
                'url' => env('API_STAGING_URL', 'https://staging-api.coolify.io') . '/api',
                'description' => 'Staging API Server',
            ],
        ],

        'security' => [
            [
                'bearerAuth' => [],
            ],
        ],

        'tags' => [
            ['name' => 'Organizations', 'description' => 'Organization management endpoints'],
            ['name' => 'Applications', 'description' => 'Application deployment and management'],
            ['name' => 'Servers', 'description' => 'Server management and provisioning'],
            ['name' => 'Databases', 'description' => 'Database management'],
            ['name' => 'Infrastructure', 'description' => 'Terraform infrastructure provisioning'],
            ['name' => 'Monitoring', 'description' => 'Resource monitoring and capacity planning'],
            ['name' => 'Billing', 'description' => 'Subscription and payment management'],
            ['name' => 'Domains', 'description' => 'Domain and DNS management'],
            ['name' => 'Authentication', 'description' => 'API token management'],
        ],
    ],
];
```

### Enhanced OpenAPI Spec with Swagger UI Extensions

Update the OpenAPI spec from Task 57 to include Swagger UI-specific extensions:

```yaml
openapi: 3.0.0
info:
  title: Coolify Enterprise API
  version: 1.0.0
  description: |
    # Coolify Enterprise API

    Welcome to the Coolify Enterprise API documentation. This API provides comprehensive access to all platform features including:

    - **Organization Management** - Hierarchical multi-tenant organization structures
    - **Application Deployment** - Git-based deployments with advanced strategies
    - **Server Management** - Server provisioning, monitoring, and capacity planning
    - **Infrastructure Provisioning** - Terraform-based cloud infrastructure automation
    - **Resource Monitoring** - Real-time metrics and capacity planning
    - **Billing & Subscriptions** - Payment processing and subscription management
    - **Domain Management** - DNS and SSL certificate automation

    ## Authentication

    All API requests require a **Sanctum Bearer token**. Obtain your token from:
    1. Log in to your Coolify dashboard
    2. Navigate to **Settings ‚Üí API Keys**
    3. Create a new API key with required scopes
    4. Use the token in the `Authorization: Bearer {token}` header

    ## Organization Scoping

    All API requests are automatically scoped to the organization associated with your token. You cannot access resources from organizations you don't belong to.

    ## Rate Limiting

    API rate limits are based on your subscription tier:
    - **Starter:** 100 requests/minute
    - **Professional:** 500 requests/minute
    - **Enterprise:** 2000 requests/minute

    Rate limit information is included in response headers:
    - `X-RateLimit-Limit` - Total requests allowed per window
    - `X-RateLimit-Remaining` - Requests remaining
    - `X-RateLimit-Reset` - Timestamp when limit resets

    ## Error Handling

    The API uses standard HTTP status codes:
    - `200` - Success
    - `201` - Created
    - `400` - Bad Request (validation errors)
    - `401` - Unauthorized (missing or invalid token)
    - `403` - Forbidden (insufficient permissions)
    - `404` - Not Found
    - `429` - Too Many Requests (rate limit exceeded)
    - `500` - Internal Server Error

  contact:
    name: Coolify Support
    email: support@coolify.io
    url: https://coolify.io/support
  license:
    name: Proprietary
    url: https://coolify.io/license

servers:
  - url: https://api.coolify.io/api
    description: Production API Server
  - url: https://staging-api.coolify.io/api
    description: Staging API Server

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: Sanctum Token
      description: |
        Use a Sanctum API token from Settings > API Keys.
        Format: `Authorization: Bearer {your-token-here}`

        **Example:**
        ```
        Authorization: Bearer 1|AbCdEfGhIjKlMnOpQrStUvWxYz
        ```

  responses:
    UnauthorizedError:
      description: Access token is missing or invalid
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: Unauthenticated.
          examples:
            missing_token:
              summary: Missing Token
              value:
                message: Unauthenticated.
            invalid_token:
              summary: Invalid Token
              value:
                message: Invalid or expired token.

    ForbiddenError:
      description: Insufficient permissions for this resource
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: This action is unauthorized.

    RateLimitError:
      description: Too many requests - rate limit exceeded
      headers:
        X-RateLimit-Limit:
          description: Request limit per window
          schema:
            type: integer
            example: 100
        X-RateLimit-Remaining:
          description: Requests remaining in current window
          schema:
            type: integer
            example: 0
        X-RateLimit-Reset:
          description: Unix timestamp when limit resets
          schema:
            type: integer
            example: 1699564800
        Retry-After:
          description: Seconds until you can retry
          schema:
            type: integer
            example: 60
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                example: Too Many Requests
              retry_after:
                type: integer
                example: 60

tags:
  - name: Organizations
    description: Manage hierarchical organization structures
    externalDocs:
      description: Organization Management Guide
      url: https://docs.coolify.io/organizations
  - name: Applications
    description: Deploy and manage applications
    externalDocs:
      description: Application Deployment Guide
      url: https://docs.coolify.io/applications
  - name: Servers
    description: Provision and manage servers
  - name: Infrastructure
    description: Terraform-based infrastructure provisioning
  - name: Monitoring
    description: Resource monitoring and capacity planning
  - name: Billing
    description: Subscriptions and payment management
  - name: Domains
    description: Domain registration and DNS management

paths:
  /organizations:
    get:
      summary: List all organizations
      description: |
        Retrieve all organizations the authenticated user has access to.
        Results are automatically scoped to your token's permissions.
      operationId: listOrganizations
      tags:
        - Organizations
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successful response
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/headers/X-RateLimit-Limit'
            X-RateLimit-Remaining:
              $ref: '#/components/headers/X-RateLimit-Remaining'
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Organization'
              examples:
                success:
                  summary: Successful response
                  value:
                    data:
                      - id: 1
                        name: Acme Corporation
                        slug: acme-corp
                        type: top_branch
                        parent_id: null
                        created_at: "2024-01-15T10:30:00Z"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '429':
          $ref: '#/components/responses/RateLimitError'

  # ... (additional endpoints from Task 57)

components:
  schemas:
    Organization:
      type: object
      description: Organization entity with hierarchical structure
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: Acme Corporation
        slug:
          type: string
          example: acme-corp
        type:
          type: string
          enum: [top_branch, master_branch, sub_user, end_user]
          example: top_branch
        parent_id:
          type: integer
          nullable: true
          example: null
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

  headers:
    X-RateLimit-Limit:
      description: Request limit per time window
      schema:
        type: integer
        example: 100
    X-RateLimit-Remaining:
      description: Requests remaining in current window
      schema:
        type: integer
        example: 95
    X-RateLimit-Reset:
      description: Unix timestamp when limit resets
      schema:
        type: integer
        example: 1699564800
```

## Implementation Approach

### Step 1: Install Dependencies

**Option A: Use CDN (Recommended)**
No installation required. Swagger UI assets loaded from CDN in the Blade template.

**Option B: Self-host Assets**
```bash
npm install swagger-ui-dist --save
```

Then publish assets:
```bash
php artisan vendor:publish --tag=swagger-ui
```

### Step 2: Create API Configuration File

1. Create `config/api.php` with Swagger UI and OpenAPI settings
2. Add environment variables to `.env`:
   ```env
   API_VERSION=1.0.0
   API_DOCS_ENABLED=true
   API_DOCS_TITLE="Coolify Enterprise API"
   SWAGGER_UI_USE_CDN=true
   ```

### Step 3: Create Controller and Routes

1. Create `ApiDocumentationController` with `index()`, `config()`, `authInstructions()` methods
2. Add routes in `routes/api.php` for `/api/docs` and related endpoints
3. Ensure OpenAPI spec route from Task 57 is accessible at `/api/openapi.yaml`

### Step 4: Create Blade Template

1. Create `resources/views/api/swagger-ui.blade.php`
2. Load Swagger UI CSS and JS from CDN
3. Initialize SwaggerUIBundle with configuration
4. Add custom styles for Coolify branding and dark mode

### Step 5: Add Request/Response Interceptors

1. Implement `requestInterceptor` to add organization context headers
2. Implement `responseInterceptor` to handle rate limiting and errors
3. Add custom error handling for 401, 403, 429 responses
4. Display rate limit information in console/UI

### Step 6: Enhance OpenAPI Specification

1. Update OpenAPI spec from Task 57 with detailed descriptions
2. Add comprehensive examples for all endpoints
3. Include authentication documentation
4. Add rate limiting information in responses

### Step 7: Custom Branding and Styling

1. Add Coolify logo to Swagger UI topbar
2. Apply custom color scheme matching Coolify theme
3. Implement dark mode support
4. Add authentication banner with instructions

### Step 8: Testing and Validation

1. Test Swagger UI loads correctly
2. Verify "Try it out" functionality with real API calls
3. Test authentication flow with Sanctum tokens
4. Validate rate limiting displays correctly
5. Test deep linking to specific endpoints
6. Verify mobile responsive design

## Test Strategy

### Manual Testing Checklist

**Basic Functionality:**
- [ ] Swagger UI loads at `/api/docs`
- [ ] OpenAPI spec loads correctly
- [ ] All endpoints visible and categorized
- [ ] Search functionality works
- [ ] Deep linking works (e.g., `/api/docs#/organizations/listOrganizations`)

**Authentication Testing:**
- [ ] "Authorize" button opens authentication modal
- [ ] Bearer token input field accepts tokens
- [ ] Authorization persists across page refreshes
- [ ] Authenticated requests include `Authorization` header
- [ ] 401 errors displayed when token is invalid

**"Try It Out" Testing:**
- [ ] "Try it out" button enables request editing
- [ ] Request parameters can be modified
- [ ] "Execute" sends request to API
- [ ] Response displays correctly (status, headers, body)
- [ ] Rate limit headers displayed in response headers section
- [ ] Error responses formatted correctly

**Rate Limiting:**
- [ ] Rate limit headers visible in responses
- [ ] 429 error displays when limit exceeded
- [ ] `Retry-After` header shown
- [ ] Rate limit info logged to console

**UI/UX:**
- [ ] Responsive design on mobile, tablet, desktop
- [ ] Dark mode works correctly
- [ ] Custom Coolify branding visible
- [ ] Authentication banner dismisses after auth
- [ ] Examples expand/collapse correctly

### Integration Tests

**File:** `tests/Feature/Api/SwaggerUiTest.php`

```php
<?php

use Illuminate\Support\Facades\Route;

it('displays Swagger UI at /api/docs', function () {
    $response = $this->get('/api/docs');

    $response->assertOk()
        ->assertViewIs('api.swagger-ui')
        ->assertSee('Coolify Enterprise API')
        ->assertSee('swagger-ui');
});

it('serves Swagger UI configuration', function () {
    $response = $this->get('/api/docs/config');

    $response->assertOk()
        ->assertJson([
            'deepLinking' => true,
            'tryItOutEnabled' => true,
            'persistAuthorization' => true,
        ]);
});

it('provides authentication instructions', function () {
    $response = $this->get('/api/docs/auth-instructions');

    $response->assertOk()
        ->assertJsonStructure([
            'message',
            'steps',
            'note',
            'documentation',
        ]);
});

it('loads OpenAPI specification', function () {
    $response = $this->get('/api/openapi.yaml');

    $response->assertOk()
        ->assertHeader('Content-Type', 'application/x-yaml; charset=UTF-8')
        ->assertSee('openapi: 3.0.0');
});

it('redirects legacy documentation URL', function () {
    $response = $this->get('/api/docs/documentation');

    $response->assertRedirect('/api/docs');
});
```

### Browser Tests (Dusk)

**File:** `tests/Browser/Api/SwaggerUiInteractionTest.php`

```php
<?php

use Laravel\Dusk\Browser;
use App\Models\User;
use App\Models\Organization;
use Laravel\Sanctum\Sanctum;

it('can authorize with Sanctum token in Swagger UI', function () {
    $user = User::factory()->create();
    $organization = Organization::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    $token = $user->createToken('test-token', ['*'])->plainTextToken;

    $this->browse(function (Browser $browser) use ($token) {
        $browser->visit('/api/docs')
            ->waitFor('.swagger-ui')
            ->click('.authorize')
            ->waitFor('.modal-ux')
            ->type('input[name="bearer"]', $token)
            ->click('button.authorize')
            ->waitUntilMissing('.modal-ux')
            ->assertSee('Authorized');
    });
});

it('can execute "Try it out" request', function () {
    $user = User::factory()->create();
    $organization = Organization::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    $token = $user->createToken('test-token', ['*'])->plainTextToken;

    $this->browse(function (Browser $browser) use ($token) {
        $browser->visit('/api/docs')
            ->waitFor('.swagger-ui')
            // Authorize first
            ->click('.authorize')
            ->waitFor('.modal-ux')
            ->type('input[name="bearer"]', $token)
            ->click('button.authorize')
            ->waitUntilMissing('.modal-ux')
            // Find GET /organizations endpoint
            ->click('.opblock-tag-section .opblock-summary-get')
            ->waitFor('.try-out')
            ->click('.try-out button')
            ->click('.execute')
            ->waitFor('.responses-wrapper')
            ->assertSee('200');
    });
});

it('displays rate limit information in response', function () {
    $user = User::factory()->create();
    $token = $user->createToken('test-token', ['*'])->plainTextToken;

    $this->browse(function (Browser $browser) use ($token) {
        $browser->visit('/api/docs')
            ->waitFor('.swagger-ui')
            ->click('.authorize')
            ->type('input[name="bearer"]', $token)
            ->click('button.authorize')
            ->waitUntilMissing('.modal-ux')
            ->click('.opblock-tag-section .opblock-summary-get')
            ->click('.try-out button')
            ->click('.execute')
            ->waitFor('.responses-wrapper')
            ->assertSee('x-ratelimit-limit')
            ->assertSee('x-ratelimit-remaining');
    });
});
```

### Performance Tests

```php
it('loads Swagger UI within acceptable time', function () {
    $startTime = microtime(true);

    $response = $this->get('/api/docs');

    $endTime = microtime(true);
    $loadTime = ($endTime - $startTime) * 1000; // Convert to milliseconds

    $response->assertOk();
    expect($loadTime)->toBeLessThan(500); // Should load in < 500ms
});

it('serves OpenAPI spec within acceptable time', function () {
    $startTime = microtime(true);

    $response = $this->get('/api/openapi.yaml');

    $endTime = microtime(true);
    $loadTime = ($endTime - $startTime) * 1000;

    $response->assertOk();
    expect($loadTime)->toBeLessThan(200); // Spec should generate in < 200ms
});
```

## Definition of Done

- [ ] ApiDocumentationController created with all required methods
- [ ] Blade template created for Swagger UI interface
- [ ] Routes registered in `routes/api.php`
- [ ] Configuration file created in `config/api.php`
- [ ] Swagger UI accessible at `/api/docs` route
- [ ] OpenAPI specification loads correctly from `/api/openapi.yaml`
- [ ] "Try it out" functionality works with Bearer token authentication
- [ ] Request interceptor adds organization context headers
- [ ] Response interceptor displays rate limit information
- [ ] Authentication banner with clear instructions displayed
- [ ] Custom Coolify branding applied (logo, colors)
- [ ] Dark mode support implemented
- [ ] Responsive design tested on mobile, tablet, desktop
- [ ] Deep linking to specific endpoints functional
- [ ] Search functionality working for filtering endpoints
- [ ] Error handling for 401, 403, 429, 500 implemented
- [ ] Integration tests written and passing (5+ tests)
- [ ] Browser tests written and passing (3+ tests with Dusk)
- [ ] Performance tests passing (load time < 500ms)
- [ ] Manual testing completed with real Sanctum tokens
- [ ] Documentation updated with Swagger UI usage instructions
- [ ] Code reviewed and approved
- [ ] Laravel Pint formatting applied
- [ ] PHPStan level 5 passing with zero errors
- [ ] No console errors or warnings in browser

## Related Tasks

- **Depends on:** Task 57 (Enhanced OpenAPI specification with organization scoping)
- **Integrates with:** Task 53 (ApiOrganizationScope middleware for org context)
- **Integrates with:** Task 54 (Rate limiting middleware for API endpoints)
- **Integrates with:** Task 56 (New API endpoints for enterprise features)
- **Used by:** Task 59 (ApiKeyManager.vue references Swagger UI for API testing)
- **Used by:** Task 60 (ApiUsageMonitoring.vue links to Swagger UI for endpoint details)
- **Referenced in:** Task 86 (API documentation with interactive examples)
