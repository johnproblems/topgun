---
name: Build TerraformManager.vue wizard component with cloud provider selection
status: open
created: 2025-10-06T15:23:47Z
updated: 2025-10-06T20:38:39Z
github: https://github.com/johnproblems/topgun/issues/130
depends_on: [14]
parallel: true
conflicts_with: []
---

# Task: Build TerraformManager.vue wizard component with cloud provider selection

## Description

Create a comprehensive multi-step wizard Vue.js component for provisioning cloud infrastructure via Terraform. This wizard guides users through selecting a cloud provider (AWS, DigitalOcean, Hetzner, GCP, Azure), configuring server specifications, reviewing estimated costs, and initiating infrastructure deployment. The component integrates with the TerraformService backend and provides real-time feedback throughout the provisioning process.

**Key Features:**
- Multi-step wizard interface with progress indicator (4 steps: Provider Selection → Configuration → Review → Provision)
- Support for 5 major cloud providers with provider-specific configuration forms
- Server specification customization (instance type, region, disk size, network settings)
- Real-time cost estimation based on selected configuration
- Terraform template preview before provisioning
- Server naming, tagging, and metadata configuration
- Integration with CloudProviderCredentials for API key management
- Form validation with provider-specific rules
- Error handling with clear user guidance

**User Workflow:**
1. Click "Provision Infrastructure" in organization dashboard
2. **Step 1:** Select cloud provider (AWS/DigitalOcean/Hetzner/GCP/Azure)
3. **Step 2:** Configure server specs (instance type, region, disk, networking)
4. **Step 3:** Review configuration and estimated monthly cost
5. **Step 4:** Confirm and provision (dispatches TerraformDeploymentJob)
6. Redirected to DeploymentMonitoring.vue to track progress

**Integration Points:**
- Backend: `app/Http/Controllers/Enterprise/TerraformController.php`
- Service: `app/Services/Enterprise/TerraformService.php`
- Job: `app/Jobs/Enterprise/TerraformDeploymentJob.php`
- Model: `app/Models/Enterprise/TerraformDeployment.php`
- Sibling Components: CloudProviderCredentials.vue, DeploymentMonitoring.vue

## Acceptance Criteria

- [ ] Multi-step wizard with 4 distinct steps implemented
- [ ] Progress indicator shows current step and allows backward navigation
- [ ] Provider selection step with cards for AWS, DigitalOcean, Hetzner, GCP, Azure
- [ ] Provider-specific configuration forms (different fields per provider)
- [ ] Instance type selection with dropdown showing available sizes
- [ ] Region selection with dropdown showing available regions per provider
- [ ] Disk size configuration with validation (min/max per provider)
- [ ] Network configuration (VPC/Subnet for AWS, private networking for others)
- [ ] Server naming with organization prefix and validation
- [ ] Tag editor for custom metadata
- [ ] Real-time cost estimation API integration
- [ ] Configuration review panel with all selections displayed
- [ ] Terraform template preview (read-only syntax-highlighted HCL)
- [ ] Form validation per step (cannot proceed with invalid data)
- [ ] Error handling for API failures, invalid configurations
- [ ] Loading states during API calls
- [ ] Success confirmation with redirect to monitoring
- [ ] Mobile-responsive design
- [ ] Accessibility compliance (keyboard navigation, ARIA labels)

## Technical Details

### Component Location
- **File:** `resources/js/Components/Enterprise/Infrastructure/TerraformManager.vue`

### Component Structure

```vue
<script setup>
import { ref, computed, watch } from 'vue'
import { useForm } from '@inertiajs/vue3'
import { useDebounceFn } from '@vueuse/core'
import axios from 'axios'

const props = defineProps({
  organization: Object,
  cloudProviderCredentials: Array,
  availableProviders: Array,
})

const emit = defineEmits(['provisioning-started', 'step-changed'])

// Wizard state
const currentStep = ref(1)
const totalSteps = 4
const isProvisioning = ref(false)

// Form state
const form = useForm({
  provider: null,
  credential_id: null,
  instance_type: null,
  region: null,
  disk_size_gb: 50,
  networking: {
    vpc_id: null,
    subnet_id: null,
    private_networking: true,
  },
  server_name: `${props.organization.slug}-server-1`,
  tags: {},
  ssh_key_id: null,
})

// Cost estimation
const estimatedCost = ref(null)
const isCalculatingCost = ref(false)

// Provider configurations
const providerConfigs = {
  aws: {
    name: 'Amazon Web Services',
    icon: '/images/providers/aws.svg',
    instanceTypes: [
      { value: 't3.micro', label: 't3.micro - 1 vCPU, 1 GB RAM', hourly: 0.0104 },
      { value: 't3.small', label: 't3.small - 2 vCPU, 2 GB RAM', hourly: 0.0208 },
      { value: 't3.medium', label: 't3.medium - 2 vCPU, 4 GB RAM', hourly: 0.0416 },
      { value: 't3.large', label: 't3.large - 2 vCPU, 8 GB RAM', hourly: 0.0832 },
    ],
    regions: [
      { value: 'us-east-1', label: 'US East (N. Virginia)' },
      { value: 'us-west-2', label: 'US West (Oregon)' },
      { value: 'eu-west-1', label: 'Europe (Ireland)' },
      { value: 'ap-southeast-1', label: 'Asia Pacific (Singapore)' },
    ],
    hasVPC: true,
  },
  digitalocean: {
    name: 'DigitalOcean',
    icon: '/images/providers/digitalocean.svg',
    instanceTypes: [
      { value: 's-1vcpu-1gb', label: 'Basic - 1 vCPU, 1 GB RAM', hourly: 0.00744 },
      { value: 's-2vcpu-2gb', label: 'Basic - 2 vCPU, 2 GB RAM', hourly: 0.01488 },
      { value: 's-2vcpu-4gb', label: 'Basic - 2 vCPU, 4 GB RAM', hourly: 0.02976 },
      { value: 's-4vcpu-8gb', label: 'General Purpose - 4 vCPU, 8 GB RAM', hourly: 0.0595 },
    ],
    regions: [
      { value: 'nyc1', label: 'New York 1' },
      { value: 'sfo3', label: 'San Francisco 3' },
      { value: 'lon1', label: 'London 1' },
      { value: 'sgp1', label: 'Singapore 1' },
    ],
    hasVPC: false,
  },
  hetzner: {
    name: 'Hetzner Cloud',
    icon: '/images/providers/hetzner.svg',
    instanceTypes: [
      { value: 'cx11', label: 'CX11 - 1 vCPU, 2 GB RAM', hourly: 0.0052 },
      { value: 'cx21', label: 'CX21 - 2 vCPU, 4 GB RAM', hourly: 0.0095 },
      { value: 'cx31', label: 'CX31 - 2 vCPU, 8 GB RAM', hourly: 0.0174 },
      { value: 'cx41', label: 'CX41 - 4 vCPU, 16 GB RAM', hourly: 0.0315 },
    ],
    regions: [
      { value: 'nbg1', label: 'Nuremberg' },
      { value: 'fsn1', label: 'Falkenstein' },
      { value: 'hel1', label: 'Helsinki' },
    ],
    hasVPC: false,
  },
  gcp: {
    name: 'Google Cloud Platform',
    icon: '/images/providers/gcp.svg',
    instanceTypes: [
      { value: 'e2-micro', label: 'e2-micro - 2 vCPU, 1 GB RAM', hourly: 0.0084 },
      { value: 'e2-small', label: 'e2-small - 2 vCPU, 2 GB RAM', hourly: 0.0168 },
      { value: 'e2-medium', label: 'e2-medium - 2 vCPU, 4 GB RAM', hourly: 0.0336 },
      { value: 'n1-standard-1', label: 'n1-standard-1 - 1 vCPU, 3.75 GB RAM', hourly: 0.0475 },
    ],
    regions: [
      { value: 'us-central1', label: 'Iowa (us-central1)' },
      { value: 'us-east1', label: 'South Carolina (us-east1)' },
      { value: 'europe-west1', label: 'Belgium (europe-west1)' },
      { value: 'asia-east1', label: 'Taiwan (asia-east1)' },
    ],
    hasVPC: true,
  },
  azure: {
    name: 'Microsoft Azure',
    icon: '/images/providers/azure.svg',
    instanceTypes: [
      { value: 'Standard_B1s', label: 'B1s - 1 vCPU, 1 GB RAM', hourly: 0.0104 },
      { value: 'Standard_B2s', label: 'B2s - 2 vCPU, 4 GB RAM', hourly: 0.0416 },
      { value: 'Standard_D2s_v3', label: 'D2s v3 - 2 vCPU, 8 GB RAM', hourly: 0.096 },
    ],
    regions: [
      { value: 'eastus', label: 'East US' },
      { value: 'westus2', label: 'West US 2' },
      { value: 'westeurope', label: 'West Europe' },
      { value: 'southeastasia', label: 'Southeast Asia' },
    ],
    hasVPC: true,
  },
}

// Computed properties
const selectedProviderConfig = computed(() => {
  return form.provider ? providerConfigs[form.provider] : null
})

const availableInstanceTypes = computed(() => {
  return selectedProviderConfig.value?.instanceTypes || []
})

const availableRegions = computed(() => {
  return selectedProviderConfig.value?.regions || []
})

const canProceedToNextStep = computed(() => {
  switch (currentStep.value) {
    case 1:
      return form.provider && form.credential_id
    case 2:
      return form.instance_type && form.region && form.disk_size_gb >= 10
    case 3:
      return form.server_name && form.server_name.length >= 3
    default:
      return true
  }
})

const progressPercentage = computed(() => {
  return ((currentStep.value - 1) / (totalSteps - 1)) * 100
})

// Cost estimation with debounce
const debouncedCalculateCost = useDebounceFn(async () => {
  if (!form.instance_type || !form.region) return

  isCalculatingCost.value = true

  try {
    const response = await axios.post(route('enterprise.terraform.estimate-cost'), {
      provider: form.provider,
      instance_type: form.instance_type,
      region: form.region,
      disk_size_gb: form.disk_size_gb,
    })

    estimatedCost.value = response.data
  } catch (error) {
    console.error('Cost estimation failed:', error)
  } finally {
    isCalculatingCost.value = false
  }
}, 500)

// Watch for configuration changes
watch(
  () => [form.instance_type, form.region, form.disk_size_gb],
  () => {
    debouncedCalculateCost()
  },
  { deep: true }
)

// Navigation methods
const nextStep = () => {
  if (currentStep.value < totalSteps && canProceedToNextStep.value) {
    currentStep.value++
    emit('step-changed', currentStep.value)
  }
}

const previousStep = () => {
  if (currentStep.value > 1) {
    currentStep.value--
    emit('step-changed', currentStep.value)
  }
}

const goToStep = (step) => {
  if (step <= currentStep.value) {
    currentStep.value = step
    emit('step-changed', currentStep.value)
  }
}

// Provisioning
const provisionInfrastructure = () => {
  if (!confirm('This will provision real cloud infrastructure and incur costs. Continue?')) {
    return
  }

  isProvisioning.value = true

  form.post(route('enterprise.terraform.provision', props.organization), {
    onSuccess: (response) => {
      emit('provisioning-started', response)
      // Redirect handled by backend
    },
    onError: (errors) => {
      console.error('Provisioning failed:', errors)
      isProvisioning.value = false
    },
  })
}

// Provider credential selection
const availableCredentials = computed(() => {
  if (!form.provider) return []

  return props.cloudProviderCredentials.filter(
    cred => cred.provider === form.provider
  )
})

// Auto-select credential if only one available
watch(() => form.provider, (newProvider) => {
  if (newProvider) {
    const creds = availableCredentials.value
    if (creds.length === 1) {
      form.credential_id = creds[0].id
    } else {
      form.credential_id = null
    }
  }
})
</script>

<template>
  <div class="terraform-manager">
    <!-- Wizard Header -->
    <div class="wizard-header">
      <h2 class="text-2xl font-bold">Provision Infrastructure</h2>
      <p class="text-gray-600 dark:text-gray-400">
        Deploy servers to your cloud provider using Terraform
      </p>

      <!-- Progress Indicator -->
      <div class="progress-steps">
        <div class="progress-bar">
          <div
            class="progress-bar-fill"
            :style="{ width: `${progressPercentage}%` }"
          />
        </div>

        <div class="steps">
          <button
            v-for="step in totalSteps"
            :key="step"
            class="step"
            :class="{
              'step--active': step === currentStep,
              'step--completed': step < currentStep,
              'step--clickable': step <= currentStep,
            }"
            :disabled="step > currentStep"
            @click="goToStep(step)"
          >
            <span class="step-number">{{ step }}</span>
            <span class="step-label">
              {{
                step === 1 ? 'Provider' :
                step === 2 ? 'Configure' :
                step === 3 ? 'Review' :
                'Provision'
              }}
            </span>
          </button>
        </div>
      </div>
    </div>

    <!-- Step Content -->
    <div class="wizard-content">
      <!-- Step 1: Provider Selection -->
      <div v-show="currentStep === 1" class="step-panel">
        <h3 class="panel-title">Select Cloud Provider</h3>

        <div class="provider-grid">
          <button
            v-for="(config, key) in providerConfigs"
            :key="key"
            class="provider-card"
            :class="{ 'provider-card--selected': form.provider === key }"
            @click="form.provider = key"
          >
            <img :src="config.icon" :alt="config.name" class="provider-icon" />
            <span class="provider-name">{{ config.name }}</span>
            <svg v-if="form.provider === key" class="checkmark" /* ... */ />
          </button>
        </div>

        <!-- Credential Selection -->
        <div v-if="form.provider" class="form-group mt-6">
          <label>API Credentials</label>
          <select v-model="form.credential_id" class="select" required>
            <option value="">Select credentials...</option>
            <option
              v-for="cred in availableCredentials"
              :key="cred.id"
              :value="cred.id"
            >
              {{ cred.name }}
            </option>
          </select>

          <p class="help-text">
            <router-link :to="{ name: 'cloud-credentials' }">
              Manage credentials
            </router-link>
          </p>

          <p v-if="form.errors.credential_id" class="error-text">
            {{ form.errors.credential_id }}
          </p>
        </div>
      </div>

      <!-- Step 2: Configuration -->
      <div v-show="currentStep === 2" class="step-panel">
        <h3 class="panel-title">Configure Server</h3>

        <div class="form-grid">
          <!-- Instance Type -->
          <div class="form-group">
            <label>Instance Type</label>
            <select v-model="form.instance_type" class="select" required>
              <option value="">Select instance type...</option>
              <option
                v-for="type in availableInstanceTypes"
                :key="type.value"
                :value="type.value"
              >
                {{ type.label }} - ${{ (type.hourly * 730).toFixed(2) }}/mo
              </option>
            </select>
            <p v-if="form.errors.instance_type" class="error-text">
              {{ form.errors.instance_type }}
            </p>
          </div>

          <!-- Region -->
          <div class="form-group">
            <label>Region</label>
            <select v-model="form.region" class="select" required>
              <option value="">Select region...</option>
              <option
                v-for="region in availableRegions"
                :key="region.value"
                :value="region.value"
              >
                {{ region.label }}
              </option>
            </select>
            <p v-if="form.errors.region" class="error-text">
              {{ form.errors.region }}
            </p>
          </div>

          <!-- Disk Size -->
          <div class="form-group">
            <label>Disk Size (GB)</label>
            <input
              v-model.number="form.disk_size_gb"
              type="number"
              min="10"
              max="1000"
              class="input"
              required
            />
            <p class="help-text">Minimum 10 GB, maximum 1000 GB</p>
          </div>

          <!-- Networking (AWS/GCP only) -->
          <div v-if="selectedProviderConfig?.hasVPC" class="form-group col-span-2">
            <label class="checkbox-label">
              <input
                v-model="form.networking.private_networking"
                type="checkbox"
                class="checkbox"
              />
              Enable private networking
            </label>
          </div>
        </div>

        <!-- Server Naming -->
        <div class="form-group mt-6">
          <label>Server Name</label>
          <input
            v-model="form.server_name"
            type="text"
            class="input"
            placeholder="my-server-1"
            pattern="^[a-z0-9-]+$"
            required
          />
          <p class="help-text">Lowercase letters, numbers, and hyphens only</p>
          <p v-if="form.errors.server_name" class="error-text">
            {{ form.errors.server_name }}
          </p>
        </div>

        <!-- Tags -->
        <div class="form-group mt-4">
          <label>Tags (Optional)</label>
          <div class="tag-editor">
            <input
              v-for="(value, key) in form.tags"
              :key="key"
              v-model="form.tags[key]"
              type="text"
              class="input tag-input"
              :placeholder="`${key}=${value}`"
            />
            <button type="button" class="btn btn-secondary btn-sm" @click="addTag">
              Add Tag
            </button>
          </div>
        </div>
      </div>

      <!-- Step 3: Review -->
      <div v-show="currentStep === 3" class="step-panel">
        <h3 class="panel-title">Review Configuration</h3>

        <div class="review-panel">
          <div class="review-section">
            <h4>Provider</h4>
            <p>{{ selectedProviderConfig?.name }}</p>
          </div>

          <div class="review-section">
            <h4>Instance</h4>
            <p>{{ form.instance_type }} in {{ form.region }}</p>
          </div>

          <div class="review-section">
            <h4>Storage</h4>
            <p>{{ form.disk_size_gb }} GB</p>
          </div>

          <div class="review-section">
            <h4>Server Name</h4>
            <p>{{ form.server_name }}</p>
          </div>

          <!-- Cost Estimate -->
          <div class="cost-estimate">
            <h4>Estimated Monthly Cost</h4>
            <p v-if="isCalculatingCost" class="text-gray-500">
              Calculating...
            </p>
            <p v-else-if="estimatedCost" class="text-2xl font-bold text-green-600">
              ${{ estimatedCost.monthly_cost.toFixed(2) }}/month
            </p>
            <p v-else class="text-gray-500">
              Unable to calculate cost
            </p>
            <p class="text-sm text-gray-500 mt-2">
              Plus applicable taxes and data transfer fees
            </p>
          </div>
        </div>

        <!-- Terraform Template Preview -->
        <div class="template-preview mt-6">
          <h4>Terraform Configuration</h4>
          <pre class="code-block"><code>{{ terraformTemplate }}</code></pre>
        </div>
      </div>

      <!-- Step 4: Provision -->
      <div v-show="currentStep === 4" class="step-panel">
        <h3 class="panel-title">Ready to Provision</h3>

        <div class="confirmation-panel">
          <svg class="icon-warning" /* ... */ />

          <h4>Important Information</h4>
          <ul class="confirmation-list">
            <li>This will provision real infrastructure on {{ selectedProviderConfig?.name }}</li>
            <li>You will be charged by your cloud provider based on usage</li>
            <li>Estimated monthly cost: ${{ estimatedCost?.monthly_cost.toFixed(2) }}</li>
            <li>Provisioning typically takes 3-5 minutes</li>
            <li>You can monitor progress on the next screen</li>
          </ul>

          <div class="confirmation-actions">
            <button
              type="button"
              class="btn btn-secondary"
              @click="previousStep"
            >
              Back to Review
            </button>

            <button
              type="button"
              class="btn btn-primary"
              :disabled="isProvisioning"
              @click="provisionInfrastructure"
            >
              <svg v-if="isProvisioning" class="animate-spin" /* ... */ />
              {{ isProvisioning ? 'Provisioning...' : 'Provision Infrastructure' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Footer -->
    <div class="wizard-footer">
      <button
        v-if="currentStep > 1 && currentStep < 4"
        type="button"
        class="btn btn-secondary"
        @click="previousStep"
      >
        Previous
      </button>

      <button
        v-if="currentStep < 3"
        type="button"
        class="btn btn-primary"
        :disabled="!canProceedToNextStep"
        @click="nextStep"
      >
        Next
      </button>

      <button
        v-if="currentStep === 3"
        type="button"
        class="btn btn-primary"
        @click="nextStep"
      >
        Continue to Provision
      </button>
    </div>
  </div>
</template>

<style scoped>
.terraform-manager {
  max-width: 1000px;
  margin: 0 auto;
  padding: 2rem;
}

.wizard-header {
  margin-bottom: 2rem;
}

.progress-steps {
  margin-top: 2rem;
}

.progress-bar {
  height: 4px;
  background: #e5e7eb;
  border-radius: 2px;
  overflow: hidden;
  margin-bottom: 1rem;
}

.progress-bar-fill {
  height: 100%;
  background: #3b82f6;
  transition: width 0.3s ease;
}

.steps {
  display: flex;
  justify-content: space-between;
  gap: 1rem;
}

.step {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem;
  border: 2px solid #e5e7eb;
  border-radius: 0.5rem;
  background: white;
  cursor: default;
  flex: 1;
}

.step--clickable {
  cursor: pointer;
}

.step--active {
  border-color: #3b82f6;
  background: #eff6ff;
}

.step--completed {
  border-color: #10b981;
}

.provider-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.provider-card {
  padding: 2rem;
  border: 2px solid #e5e7eb;
  border-radius: 0.5rem;
  background: white;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}

.provider-card--selected {
  border-color: #3b82f6;
  background: #eff6ff;
}

.provider-icon {
  width: 64px;
  height: 64px;
  margin: 0 auto 1rem;
}

.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}

.review-panel {
  background: #f9fafb;
  padding: 1.5rem;
  border-radius: 0.5rem;
}

.cost-estimate {
  margin-top: 2rem;
  padding: 1.5rem;
  background: white;
  border-radius: 0.5rem;
  border: 2px solid #10b981;
}

.code-block {
  background: #1f2937;
  color: #f3f4f6;
  padding: 1rem;
  border-radius: 0.5rem;
  overflow-x: auto;
  font-family: 'Courier New', monospace;
  font-size: 0.875rem;
}

.wizard-footer {
  display: flex;
  justify-content: space-between;
  margin-top: 2rem;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
}

@media (max-width: 768px) {
  .provider-grid {
    grid-template-columns: 1fr;
  }

  .form-grid {
    grid-template-columns: 1fr;
  }
}
</style>
```

### Backend Controller

**File:** `app/Http/Controllers/Enterprise/TerraformController.php`

```php
public function provision(Request $request, Organization $organization)
{
    $this->authorize('manageInfrastructure', $organization);

    $validated = $request->validate([
        'provider' => 'required|in:aws,digitalocean,hetzner,gcp,azure',
        'credential_id' => 'required|exists:cloud_provider_credentials,id',
        'instance_type' => 'required|string',
        'region' => 'required|string',
        'disk_size_gb' => 'required|integer|min:10|max:1000',
        'server_name' => 'required|string|regex:/^[a-z0-9-]+$/',
        'networking' => 'nullable|array',
        'tags' => 'nullable|array',
    ]);

    // Create deployment record
    $deployment = TerraformDeployment::create([
        'organization_id' => $organization->id,
        'cloud_provider_credential_id' => $validated['credential_id'],
        'provider' => $validated['provider'],
        'region' => $validated['region'],
        'configuration' => $validated,
        'status' => 'pending',
    ]);

    // Dispatch provisioning job
    TerraformDeploymentJob::dispatch($deployment);

    return redirect()->route('enterprise.terraform.monitor', [
        'organization' => $organization,
        'deployment' => $deployment,
    ]);
}

public function estimateCost(Request $request)
{
    $validated = $request->validate([
        'provider' => 'required|in:aws,digitalocean,hetzner,gcp,azure',
        'instance_type' => 'required|string',
        'region' => 'required|string',
        'disk_size_gb' => 'required|integer',
    ]);

    $terraformService = app(TerraformService::class);
    $estimate = $terraformService->calculateCost($validated);

    return response()->json($estimate);
}
```

## Implementation Approach

### Step 1: Create Component Structure
1. Create `TerraformManager.vue` in `resources/js/Components/Enterprise/Infrastructure/`
2. Set up wizard state with currentStep ref
3. Define provider configurations with pricing data
4. Set up Inertia.js form for data management

### Step 2: Build Provider Selection (Step 1)
1. Create provider card grid layout
2. Add provider icons and names
3. Implement selection state with visual feedback
4. Add credential dropdown filtered by selected provider
5. Auto-select credential if only one available

### Step 3: Build Configuration Form (Step 2)
1. Create instance type dropdown with pricing
2. Add region selection dropdown
3. Implement disk size input with validation
4. Add networking configuration (provider-specific)
5. Add server naming input with pattern validation
6. Implement tag editor for custom metadata

### Step 4: Build Review Panel (Step 3)
1. Display all selected configuration
2. Integrate cost estimation API
3. Implement debounced cost calculation
4. Add Terraform template preview
5. Display estimated monthly cost prominently

### Step 5: Build Provision Confirmation (Step 4)
1. Create confirmation panel with warnings
2. List important information about provisioning
3. Add provision button with loading state
4. Implement confirmation dialog

### Step 6: Implement Navigation
1. Add progress indicator with step numbers
2. Implement next/previous navigation
3. Add step validation (cannot proceed without required fields)
4. Allow clicking on previous steps to go back

### Step 7: Add Cost Estimation
1. Create API endpoint for cost calculation
2. Implement debounced cost fetching
3. Display cost breakdown
4. Show loading state during calculation

### Step 8: Integration and Polish
1. Connect to backend API endpoints
2. Handle errors with user-friendly messages
3. Add loading states for async operations
4. Implement mobile responsive design
5. Add accessibility features (ARIA labels, keyboard nav)

## Test Strategy

### Unit Tests (Vitest)

```javascript
import { mount } from '@vue/test-utils'
import TerraformManager from '../TerraformManager.vue'

describe('TerraformManager.vue', () => {
  it('renders all wizard steps', () => {
    const wrapper = mount(TerraformManager, {
      props: {
        organization: { id: 1, slug: 'test-org' },
        cloudProviderCredentials: [],
        availableProviders: [],
      }
    })

    expect(wrapper.text()).toContain('Provider')
    expect(wrapper.text()).toContain('Configure')
    expect(wrapper.text()).toContain('Review')
    expect(wrapper.text()).toContain('Provision')
  })

  it('prevents proceeding without required fields', async () => {
    const wrapper = mount(TerraformManager, {
      props: { organization: {}, cloudProviderCredentials: [], availableProviders: [] }
    })

    expect(wrapper.vm.canProceedToNextStep).toBe(false)

    wrapper.vm.form.provider = 'aws'
    wrapper.vm.form.credential_id = 1

    await wrapper.vm.$nextTick()

    expect(wrapper.vm.canProceedToNextStep).toBe(true)
  })

  it('calculates cost when configuration changes', async () => {
    const wrapper = mount(TerraformManager)

    wrapper.vm.form.provider = 'digitalocean'
    wrapper.vm.form.instance_type = 's-2vcpu-2gb'
    wrapper.vm.form.region = 'nyc1'

    await wrapper.vm.debouncedCalculateCost.flush()

    expect(wrapper.vm.estimatedCost).not.toBeNull()
  })

  it('shows provider-specific configuration', async () => {
    const wrapper = mount(TerraformManager)

    wrapper.vm.form.provider = 'aws'
    await wrapper.vm.$nextTick()

    expect(wrapper.vm.selectedProviderConfig.hasVPC).toBe(true)

    wrapper.vm.form.provider = 'digitalocean'
    await wrapper.vm.$nextTick()

    expect(wrapper.vm.selectedProviderConfig.hasVPC).toBe(false)
  })
})
```

### Integration Tests (Pest)

```php
it('provisions infrastructure successfully', function () {
    $organization = Organization::factory()->create();
    $user = User::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    $credential = CloudProviderCredential::factory()->create([
        'organization_id' => $organization->id,
        'provider' => 'digitalocean',
    ]);

    Queue::fake();

    $this->actingAs($user)
        ->post(route('enterprise.terraform.provision', $organization), [
            'provider' => 'digitalocean',
            'credential_id' => $credential->id,
            'instance_type' => 's-2vcpu-2gb',
            'region' => 'nyc1',
            'disk_size_gb' => 50,
            'server_name' => 'test-server-1',
        ])
        ->assertRedirect();

    Queue::assertPushed(TerraformDeploymentJob::class);

    $this->assertDatabaseHas('terraform_deployments', [
        'organization_id' => $organization->id,
        'provider' => 'digitalocean',
        'status' => 'pending',
    ]);
});

it('estimates cost accurately', function () {
    $this->postJson(route('enterprise.terraform.estimate-cost'), [
        'provider' => 'digitalocean',
        'instance_type' => 's-2vcpu-2gb',
        'region' => 'nyc1',
        'disk_size_gb' => 50,
    ])
        ->assertSuccessful()
        ->assertJsonStructure([
            'monthly_cost',
            'hourly_cost',
            'breakdown',
        ]);
});

it('validates server name format', function () {
    $organization = Organization::factory()->create();
    $user = User::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    $credential = CloudProviderCredential::factory()->create([
        'organization_id' => $organization->id,
    ]);

    $this->actingAs($user)
        ->post(route('enterprise.terraform.provision', $organization), [
            'provider' => 'aws',
            'credential_id' => $credential->id,
            'instance_type' => 't3.micro',
            'region' => 'us-east-1',
            'disk_size_gb' => 50,
            'server_name' => 'Invalid Name With Spaces',
        ])
        ->assertSessionHasErrors('server_name');
});
```

### Browser Tests (Dusk)

```php
it('completes full provisioning wizard', function () {
    $this->browse(function (Browser $browser) use ($user, $organization, $credential) {
        $browser->loginAs($user)
            ->visit('/enterprise/organizations/1/infrastructure/provision')
            ->assertSee('Provision Infrastructure')

            // Step 1: Select provider
            ->click('@provider-digitalocean')
            ->waitFor('@credential-select')
            ->select('@credential-select', $credential->id)
            ->click('@next-button')

            // Step 2: Configure
            ->waitFor('@instance-type-select')
            ->select('@instance-type-select', 's-2vcpu-2gb')
            ->select('@region-select', 'nyc1')
            ->type('@server-name', 'my-test-server')
            ->click('@next-button')

            // Step 3: Review
            ->waitForText('Review Configuration')
            ->assertSee('s-2vcpu-2gb')
            ->assertSee('$10.88/month')
            ->click('@next-button')

            // Step 4: Provision
            ->waitForText('Ready to Provision')
            ->click('@provision-button')
            ->waitForLocation('/enterprise/organizations/1/infrastructure/monitor');
    });
});
```

## Definition of Done

- [ ] TerraformManager.vue component created with Composition API
- [ ] Multi-step wizard with 4 steps implemented
- [ ] Progress indicator with step navigation working
- [ ] Provider selection with 5 providers (AWS, DO, Hetzner, GCP, Azure)
- [ ] Provider-specific configuration forms implemented
- [ ] Instance type selection with pricing display
- [ ] Region selection per provider
- [ ] Disk size configuration with validation
- [ ] Network configuration for VPC-capable providers
- [ ] Server naming with validation
- [ ] Tag editor for custom metadata
- [ ] Cost estimation API integration working
- [ ] Debounced cost calculation implemented
- [ ] Configuration review panel complete
- [ ] Terraform template preview implemented
- [ ] Provision confirmation with warnings
- [ ] Form validation preventing invalid progression
- [ ] Backend provision endpoint created and tested
- [ ] Backend cost estimation endpoint created
- [ ] TerraformDeploymentJob dispatched on provision
- [ ] Error handling for API failures
- [ ] Loading states during async operations
- [ ] Mobile responsive design working
- [ ] Dark mode support implemented
- [ ] Accessibility compliance (keyboard nav, ARIA)
- [ ] Unit tests written and passing (8+ tests)
- [ ] Integration tests written and passing (5+ tests)
- [ ] Browser test for full wizard workflow passing
- [ ] Documentation updated with usage examples
- [ ] Code reviewed and approved
- [ ] PHPStan level 5 passing
- [ ] Laravel Pint formatting applied

## Related Tasks

- **Depends on:** Task 14 (TerraformService implementation)
- **Integrates with:** Task 21 (CloudProviderCredentials.vue, DeploymentMonitoring.vue)
- **Integrates with:** Task 18 (TerraformDeploymentJob)
- **Integrates with:** Task 13 (CloudProviderCredential model)
- **Used by:** Organization administrators for infrastructure provisioning
