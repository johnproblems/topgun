---
name: Build ThemeCustomizer.vue with live color picker and real-time CSS preview
status: open
created: 2025-10-06T15:23:47Z
updated: 2025-10-06T20:38:25Z
github: https://github.com/johnproblems/topgun/issues/116
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Build ThemeCustomizer.vue with live color picker and real-time CSS preview

## Description

Create a sophisticated Vue.js 3 component for advanced theme customization that goes beyond basic color selection. This component provides a professional color picker interface with real-time CSS variable generation, color palette management, and live preview capabilities. It serves as a specialized sub-component of the white-label branding system, offering designers and administrators fine-grained control over the platform's visual theming.

The ThemeCustomizer enables users to:
1. Select colors using an advanced color picker with RGB, HSL, and HEX input modes
2. Generate harmonious color palettes automatically (complementary, analogous, triadic)
3. Preview color combinations in real-time against various UI elements
4. Create and manage multiple theme presets (light mode, dark mode, custom)
5. Export CSS custom properties for direct use in stylesheets
6. Test accessibility compliance (WCAG AA/AAA contrast ratios)
7. Apply predefined color schemes from a curated library

This component integrates seamlessly with the broader white-label architecture by:
- Working within the BrandingManager.vue parent component (Task 5)
- Utilizing the DynamicAssetController for CSS compilation (Task 2)
- Integrating with BrandingPreview.vue for real-time visualization (Task 8)
- Storing configurations in the WhiteLabelConfig model
- Supporting both manual color selection and AI-assisted palette generation

**Why this task is important:** While basic color selection is straightforward, professional branding requires sophisticated color management. Organizations need to ensure their color choices work harmoniously across all UI states (hover, active, disabled), maintain adequate contrast for accessibility, and reflect their brand guidelines. This component provides the tools necessary for professional-grade theme customization without requiring design expertise.

The ThemeCustomizer elevates the white-label system from basic customization to professional design tooling, enabling organizations to create polished, accessible, and brand-consistent themes. It reduces the iteration cycle from hours to minutes, provides instant feedback on accessibility issues, and ensures visual consistency across the entire platform.

## Acceptance Criteria

- [ ] Advanced color picker implemented with RGB, HSL, and HEX input modes
- [ ] Color palette generator creates harmonious color schemes (complementary, analogous, triadic, split-complementary)
- [ ] Real-time CSS custom properties generation and preview
- [ ] Contrast ratio calculator for accessibility testing (WCAG AA/AAA compliance)
- [ ] Multiple theme preset management (create, save, load, delete)
- [ ] Predefined color scheme library with 10+ professional palettes
- [ ] Live preview of selected colors against UI components (buttons, links, cards, inputs)
- [ ] Color picker supports opacity/alpha channel selection
- [ ] Recently used colors history (last 10 colors)
- [ ] Color naming system for better organization
- [ ] Export functionality for CSS variables
- [ ] Responsive design working on tablet and desktop (mobile shows simplified picker)
- [ ] Dark mode support for the customizer itself
- [ ] Integration with BrandingManager parent component via events
- [ ] Validation to prevent invalid color values

## Technical Details

### Component Location
- **File:** `resources/js/Components/Enterprise/WhiteLabel/ThemeCustomizer.vue`

### Component Architecture

```vue
<script setup>
import { ref, computed, watch } from 'vue'
import { useColorPalette } from '@/Composables/useColorPalette'
import { useAccessibility } from '@/Composables/useAccessibility'
import ColorPicker from './ColorPicker.vue'
import PaletteGenerator from './PaletteGenerator.vue'
import ContrastChecker from './ContrastChecker.vue'

const props = defineProps({
  initialColors: {
    type: Object,
    default: () => ({
      primary: '#3b82f6',
      secondary: '#10b981',
      accent: '#f59e0b',
      text: '#1f2937',
      background: '#ffffff',
    })
  },
  mode: {
    type: String,
    default: 'light', // light, dark
  },
})

const emit = defineEmits(['update:colors', 'preset-saved', 'preset-loaded'])

// Composables
const { generatePalette, getPaletteType } = useColorPalette()
const { checkContrast, getWCAGRating } = useAccessibility()

// State
const activeColor = ref('primary')
const colors = ref({ ...props.initialColors })
const colorHistory = ref([])
const presets = ref([])
const showPaletteSuggestions = ref(false)

// Color picker state
const pickerMode = ref('hex') // hex, rgb, hsl
const currentPickerValue = ref(colors.value.primary)

// Computed
const cssVariables = computed(() => {
  return Object.entries(colors.value).map(([key, value]) => {
    return `--color-${key}: ${value};`
  }).join('\n  ')
})

const contrastResults = computed(() => {
  return {
    textOnBackground: checkContrast(colors.value.text, colors.value.background),
    primaryOnBackground: checkContrast(colors.value.primary, colors.value.background),
    secondaryOnBackground: checkContrast(colors.value.secondary, colors.value.background),
  }
})

const accessibilityScore = computed(() => {
  const results = Object.values(contrastResults.value)
  const aaCount = results.filter(r => r.wcag === 'AA' || r.wcag === 'AAA').length
  const aaaCount = results.filter(r => r.wcag === 'AAA').length

  if (aaaCount === results.length) return 'AAA'
  if (aaCount === results.length) return 'AA'
  return 'Fail'
})

// Methods
const selectColor = (colorKey) => {
  activeColor.value = colorKey
  currentPickerValue.value = colors.value[colorKey]
}

const updateColor = (colorKey, value) => {
  colors.value[colorKey] = value

  // Add to history
  if (!colorHistory.value.includes(value)) {
    colorHistory.value.unshift(value)
    if (colorHistory.value.length > 10) {
      colorHistory.value.pop()
    }
  }

  emit('update:colors', colors.value)
}

const generatePaletteFromPrimary = (type = 'complementary') => {
  const palette = generatePalette(colors.value.primary, type)

  colors.value = {
    primary: palette.primary,
    secondary: palette.secondary,
    accent: palette.accent,
    text: props.mode === 'dark' ? '#f9fafb' : '#1f2937',
    background: props.mode === 'dark' ? '#1f2937' : '#ffffff',
  }

  showPaletteSuggestions.value = false
  emit('update:colors', colors.value)
}

const savePreset = (name) => {
  const preset = {
    id: Date.now(),
    name,
    colors: { ...colors.value },
    mode: props.mode,
    createdAt: new Date().toISOString(),
  }

  presets.value.push(preset)
  localStorage.setItem('theme-presets', JSON.stringify(presets.value))

  emit('preset-saved', preset)
}

const loadPreset = (preset) => {
  colors.value = { ...preset.colors }
  emit('preset-loaded', preset)
  emit('update:colors', colors.value)
}

const deletePreset = (presetId) => {
  presets.value = presets.value.filter(p => p.id !== presetId)
  localStorage.setItem('theme-presets', JSON.stringify(presets.value))
}

const exportCSSVariables = () => {
  const css = `:root {\n  ${cssVariables.value}\n}`

  // Copy to clipboard
  navigator.clipboard.writeText(css)

  // Download as file
  const blob = new Blob([css], { type: 'text/css' })
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = 'theme-variables.css'
  a.click()
}

const applyPredefinedScheme = (scheme) => {
  colors.value = { ...scheme.colors }
  emit('update:colors', colors.value)
}

// Load presets from localStorage
const loadPresetsFromStorage = () => {
  const stored = localStorage.getItem('theme-presets')
  if (stored) {
    presets.value = JSON.parse(stored)
  }
}

// Watch for color changes
watch(
  () => colors.value,
  (newColors) => {
    emit('update:colors', newColors)
  },
  { deep: true }
)

// Lifecycle
onMounted(() => {
  loadPresetsFromStorage()
})
</script>

<template>
  <div class="theme-customizer">
    <!-- Header -->
    <div class="customizer-header">
      <h3 class="text-lg font-semibold">Theme Customizer</h3>

      <div class="header-actions">
        <button
          type="button"
          class="btn btn-sm btn-secondary"
          @click="showPaletteSuggestions = !showPaletteSuggestions"
        >
          Generate Palette
        </button>

        <button
          type="button"
          class="btn btn-sm btn-secondary"
          @click="exportCSSVariables"
        >
          Export CSS
        </button>
      </div>
    </div>

    <!-- Palette Generator Modal -->
    <div v-if="showPaletteSuggestions" class="palette-modal">
      <div class="palette-modal-content">
        <h4>Generate Color Palette</h4>

        <div class="palette-options">
          <button
            class="palette-option"
            @click="generatePaletteFromPrimary('complementary')"
          >
            <div class="palette-preview complementary"></div>
            <span>Complementary</span>
          </button>

          <button
            class="palette-option"
            @click="generatePaletteFromPrimary('analogous')"
          >
            <div class="palette-preview analogous"></div>
            <span>Analogous</span>
          </button>

          <button
            class="palette-option"
            @click="generatePaletteFromPrimary('triadic')"
          >
            <div class="palette-preview triadic"></div>
            <span>Triadic</span>
          </button>

          <button
            class="palette-option"
            @click="generatePaletteFromPrimary('split-complementary')"
          >
            <div class="palette-preview split"></div>
            <span>Split Complementary</span>
          </button>
        </div>

        <button
          class="btn btn-secondary"
          @click="showPaletteSuggestions = false"
        >
          Cancel
        </button>
      </div>
    </div>

    <!-- Color Selection Grid -->
    <div class="color-grid">
      <button
        v-for="(value, key) in colors"
        :key="key"
        class="color-swatch"
        :class="{ 'color-swatch--active': activeColor === key }"
        :style="{ backgroundColor: value }"
        @click="selectColor(key)"
      >
        <div class="color-swatch-label">
          {{ key }}
        </div>
        <div class="color-swatch-value">
          {{ value }}
        </div>
      </button>
    </div>

    <!-- Advanced Color Picker -->
    <div class="color-picker-section">
      <div class="picker-mode-switcher">
        <button
          v-for="mode in ['hex', 'rgb', 'hsl']"
          :key="mode"
          class="mode-btn"
          :class="{ active: pickerMode === mode }"
          @click="pickerMode = mode"
        >
          {{ mode.toUpperCase() }}
        </button>
      </div>

      <ColorPicker
        :value="colors[activeColor]"
        :mode="pickerMode"
        @update="(val) => updateColor(activeColor, val)"
      />

      <!-- Recent Colors -->
      <div v-if="colorHistory.length > 0" class="recent-colors">
        <h5 class="text-sm font-medium mb-2">Recent Colors</h5>
        <div class="recent-colors-grid">
          <button
            v-for="(color, index) in colorHistory"
            :key="index"
            class="recent-color-swatch"
            :style="{ backgroundColor: color }"
            :title="color"
            @click="updateColor(activeColor, color)"
          />
        </div>
      </div>
    </div>

    <!-- Contrast Checker -->
    <div class="contrast-section">
      <h4 class="text-md font-semibold mb-3">Accessibility</h4>

      <div class="accessibility-score" :class="`score-${accessibilityScore.toLowerCase()}`">
        <span class="score-label">WCAG Rating:</span>
        <span class="score-value">{{ accessibilityScore }}</span>
      </div>

      <div class="contrast-results">
        <div
          v-for="(result, pair) in contrastResults"
          :key="pair"
          class="contrast-result"
        >
          <div class="contrast-pair">{{ pair }}</div>
          <div class="contrast-ratio">{{ result.ratio.toFixed(2) }}:1</div>
          <div class="contrast-wcag" :class="`wcag-${result.wcag.toLowerCase()}`">
            {{ result.wcag }}
          </div>
        </div>
      </div>
    </div>

    <!-- Preset Management -->
    <div class="presets-section">
      <div class="presets-header">
        <h4 class="text-md font-semibold">Presets</h4>
        <button
          class="btn btn-sm btn-primary"
          @click="() => {
            const name = prompt('Preset name:')
            if (name) savePreset(name)
          }"
        >
          Save Current
        </button>
      </div>

      <div v-if="presets.length > 0" class="presets-list">
        <div
          v-for="preset in presets"
          :key="preset.id"
          class="preset-item"
        >
          <div class="preset-colors">
            <div
              v-for="(color, key) in preset.colors"
              :key="key"
              class="preset-color"
              :style="{ backgroundColor: color }"
              :title="`${key}: ${color}`"
            />
          </div>

          <div class="preset-name">{{ preset.name }}</div>

          <div class="preset-actions">
            <button
              class="btn btn-sm btn-secondary"
              @click="loadPreset(preset)"
            >
              Load
            </button>
            <button
              class="btn btn-sm btn-danger"
              @click="deletePreset(preset.id)"
            >
              Delete
            </button>
          </div>
        </div>
      </div>

      <p v-else class="text-sm text-gray-500">
        No saved presets yet
      </p>
    </div>

    <!-- Predefined Schemes -->
    <div class="schemes-section">
      <h4 class="text-md font-semibold mb-3">Predefined Schemes</h4>

      <div class="schemes-grid">
        <button
          v-for="scheme in predefinedSchemes"
          :key="scheme.name"
          class="scheme-card"
          @click="applyPredefinedScheme(scheme)"
        >
          <div class="scheme-preview">
            <div
              v-for="(color, key) in scheme.colors"
              :key="key"
              class="scheme-color"
              :style="{ backgroundColor: color }"
            />
          </div>
          <div class="scheme-name">{{ scheme.name }}</div>
        </button>
      </div>
    </div>

    <!-- CSS Export Preview -->
    <div class="css-export">
      <h4 class="text-md font-semibold mb-2">CSS Variables</h4>
      <pre class="css-code"><code>:root {
  {{ cssVariables }}
}</code></pre>
    </div>
  </div>
</template>

<style scoped>
.theme-customizer {
  padding: 1.5rem;
  background: white;
  border-radius: 0.5rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.customizer-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #e5e7eb;
}

.header-actions {
  display: flex;
  gap: 0.5rem;
}

.color-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.color-swatch {
  position: relative;
  height: 100px;
  border: 2px solid #e5e7eb;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 0.5rem;
}

.color-swatch--active {
  border-color: #3b82f6;
  border-width: 3px;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.color-swatch-label {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: capitalize;
  color: white;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

.color-swatch-value {
  font-size: 0.7rem;
  font-family: monospace;
  color: white;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

.picker-mode-switcher {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.mode-btn {
  padding: 0.5rem 1rem;
  border: 1px solid #d1d5db;
  background: white;
  border-radius: 0.375rem;
  cursor: pointer;
  transition: all 0.2s;
}

.mode-btn.active {
  background: #3b82f6;
  color: white;
  border-color: #3b82f6;
}

.recent-colors-grid {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  gap: 0.5rem;
}

.recent-color-swatch {
  width: 100%;
  aspect-ratio: 1;
  border: 1px solid #d1d5db;
  border-radius: 0.25rem;
  cursor: pointer;
  transition: transform 0.2s;
}

.recent-color-swatch:hover {
  transform: scale(1.1);
}

.contrast-section {
  margin-top: 2rem;
  padding-top: 2rem;
  border-top: 1px solid #e5e7eb;
}

.accessibility-score {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  border-radius: 0.5rem;
  margin-bottom: 1rem;
}

.score-aaa {
  background: #d1fae5;
  color: #065f46;
}

.score-aa {
  background: #fef3c7;
  color: #92400e;
}

.score-fail {
  background: #fee2e2;
  color: #991b1b;
}

.contrast-results {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.contrast-result {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr;
  gap: 1rem;
  padding: 0.75rem;
  background: #f9fafb;
  border-radius: 0.375rem;
  align-items: center;
}

.wcag-aaa {
  color: #059669;
  font-weight: 600;
}

.wcag-aa {
  color: #d97706;
  font-weight: 600;
}

.wcag-fail {
  color: #dc2626;
  font-weight: 600;
}

.presets-section {
  margin-top: 2rem;
  padding-top: 2rem;
  border-top: 1px solid #e5e7eb;
}

.presets-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.presets-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.preset-item {
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: 1rem;
  padding: 0.75rem;
  border: 1px solid #e5e7eb;
  border-radius: 0.5rem;
  align-items: center;
}

.preset-colors {
  display: flex;
  gap: 0.25rem;
}

.preset-color {
  width: 2rem;
  height: 2rem;
  border-radius: 0.25rem;
  border: 1px solid #d1d5db;
}

.preset-actions {
  display: flex;
  gap: 0.5rem;
}

.schemes-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 1rem;
}

.scheme-card {
  padding: 1rem;
  border: 1px solid #e5e7eb;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.2s;
}

.scheme-card:hover {
  border-color: #3b82f6;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.scheme-preview {
  display: flex;
  gap: 0.25rem;
  margin-bottom: 0.5rem;
}

.scheme-color {
  flex: 1;
  height: 2rem;
  border-radius: 0.25rem;
}

.scheme-name {
  font-size: 0.875rem;
  font-weight: 500;
  text-align: center;
}

.css-export {
  margin-top: 2rem;
  padding-top: 2rem;
  border-top: 1px solid #e5e7eb;
}

.css-code {
  background: #1f2937;
  color: #e5e7eb;
  padding: 1rem;
  border-radius: 0.5rem;
  overflow-x: auto;
  font-size: 0.875rem;
  line-height: 1.6;
}

.palette-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.palette-modal-content {
  background: white;
  padding: 2rem;
  border-radius: 0.5rem;
  max-width: 600px;
  width: 90%;
}

.palette-options {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  margin: 1.5rem 0;
}

.palette-option {
  padding: 1rem;
  border: 2px solid #e5e7eb;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.2s;
}

.palette-option:hover {
  border-color: #3b82f6;
}

@media (max-width: 768px) {
  .color-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .schemes-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}
</style>
```

### Composable: useColorPalette

**File:** `resources/js/Composables/useColorPalette.js`

```javascript
export function useColorPalette() {
  // Convert hex to HSL
  const hexToHSL = (hex) => {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex)
    if (!result) return { h: 0, s: 0, l: 0 }

    let r = parseInt(result[1], 16) / 255
    let g = parseInt(result[2], 16) / 255
    let b = parseInt(result[3], 16) / 255

    const max = Math.max(r, g, b)
    const min = Math.min(r, g, b)
    let h, s, l = (max + min) / 2

    if (max === min) {
      h = s = 0
    } else {
      const d = max - min
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min)

      switch (max) {
        case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break
        case g: h = ((b - r) / d + 2) / 6; break
        case b: h = ((r - g) / d + 4) / 6; break
      }
    }

    return {
      h: Math.round(h * 360),
      s: Math.round(s * 100),
      l: Math.round(l * 100)
    }
  }

  // Convert HSL to hex
  const hslToHex = (h, s, l) => {
    s /= 100
    l /= 100

    const c = (1 - Math.abs(2 * l - 1)) * s
    const x = c * (1 - Math.abs((h / 60) % 2 - 1))
    const m = l - c / 2
    let r = 0, g = 0, b = 0

    if (0 <= h && h < 60) {
      r = c; g = x; b = 0
    } else if (60 <= h && h < 120) {
      r = x; g = c; b = 0
    } else if (120 <= h && h < 180) {
      r = 0; g = c; b = x
    } else if (180 <= h && h < 240) {
      r = 0; g = x; b = c
    } else if (240 <= h && h < 300) {
      r = x; g = 0; b = c
    } else if (300 <= h && h < 360) {
      r = c; g = 0; b = x
    }

    const toHex = (n) => {
      const hex = Math.round((n + m) * 255).toString(16)
      return hex.length === 1 ? '0' + hex : hex
    }

    return `#${toHex(r)}${toHex(g)}${toHex(b)}`
  }

  // Generate palette based on color theory
  const generatePalette = (baseColor, type = 'complementary') => {
    const hsl = hexToHSL(baseColor)

    switch (type) {
      case 'complementary':
        return {
          primary: baseColor,
          secondary: hslToHex((hsl.h + 180) % 360, hsl.s, hsl.l),
          accent: hslToHex((hsl.h + 30) % 360, Math.min(hsl.s + 10, 100), hsl.l),
        }

      case 'analogous':
        return {
          primary: baseColor,
          secondary: hslToHex((hsl.h + 30) % 360, hsl.s, hsl.l),
          accent: hslToHex((hsl.h - 30 + 360) % 360, hsl.s, hsl.l),
        }

      case 'triadic':
        return {
          primary: baseColor,
          secondary: hslToHex((hsl.h + 120) % 360, hsl.s, hsl.l),
          accent: hslToHex((hsl.h + 240) % 360, hsl.s, hsl.l),
        }

      case 'split-complementary':
        return {
          primary: baseColor,
          secondary: hslToHex((hsl.h + 150) % 360, hsl.s, hsl.l),
          accent: hslToHex((hsl.h + 210) % 360, hsl.s, hsl.l),
        }

      default:
        return {
          primary: baseColor,
          secondary: baseColor,
          accent: baseColor,
        }
    }
  }

  return {
    hexToHSL,
    hslToHex,
    generatePalette,
  }
}
```

### Composable: useAccessibility

**File:** `resources/js/Composables/useAccessibility.js`

```javascript
export function useAccessibility() {
  // Calculate relative luminance
  const getLuminance = (hex) => {
    const rgb = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex)
    if (!rgb) return 0

    const [r, g, b] = [
      parseInt(rgb[1], 16) / 255,
      parseInt(rgb[2], 16) / 255,
      parseInt(rgb[3], 16) / 255,
    ].map(channel => {
      return channel <= 0.03928
        ? channel / 12.92
        : Math.pow((channel + 0.055) / 1.055, 2.4)
    })

    return 0.2126 * r + 0.7152 * g + 0.0722 * b
  }

  // Calculate contrast ratio
  const getContrastRatio = (color1, color2) => {
    const lum1 = getLuminance(color1)
    const lum2 = getLuminance(color2)
    const lighter = Math.max(lum1, lum2)
    const darker = Math.min(lum1, lum2)

    return (lighter + 0.05) / (darker + 0.05)
  }

  // Check WCAG compliance
  const checkContrast = (foreground, background) => {
    const ratio = getContrastRatio(foreground, background)

    let wcag = 'Fail'
    if (ratio >= 7) wcag = 'AAA'
    else if (ratio >= 4.5) wcag = 'AA'

    return {
      ratio,
      wcag,
      passAA: ratio >= 4.5,
      passAAA: ratio >= 7,
    }
  }

  return {
    getLuminance,
    getContrastRatio,
    checkContrast,
  }
}
```

### Predefined Color Schemes

```javascript
const predefinedSchemes = [
  {
    name: 'Ocean Blue',
    colors: {
      primary: '#0ea5e9',
      secondary: '#06b6d4',
      accent: '#14b8a6',
      text: '#0f172a',
      background: '#ffffff',
    }
  },
  {
    name: 'Sunset Orange',
    colors: {
      primary: '#f97316',
      secondary: '#fb923c',
      accent: '#fbbf24',
      text: '#1f2937',
      background: '#ffffff',
    }
  },
  {
    name: 'Forest Green',
    colors: {
      primary: '#22c55e',
      secondary: '#16a34a',
      accent: '#84cc16',
      text: '#1e293b',
      background: '#ffffff',
    }
  },
  {
    name: 'Royal Purple',
    colors: {
      primary: '#a855f7',
      secondary: '#9333ea',
      accent: '#c084fc',
      text: '#1e293b',
      background: '#ffffff',
    }
  },
  {
    name: 'Crimson Red',
    colors: {
      primary: '#ef4444',
      secondary: '#dc2626',
      accent: '#f87171',
      text: '#1f2937',
      background: '#ffffff',
    }
  },
  {
    name: 'Dark Mode',
    colors: {
      primary: '#3b82f6',
      secondary: '#10b981',
      accent: '#f59e0b',
      text: '#f9fafb',
      background: '#1f2937',
    }
  },
]
```

## Implementation Approach

### Step 1: Create Component Structure
1. Create `ThemeCustomizer.vue` in `resources/js/Components/Enterprise/WhiteLabel/`
2. Set up Vue 3 Composition API with reactive state
3. Define props for initial colors and mode (light/dark)
4. Set up event emitters for color updates

### Step 2: Build Color Picker Interface
1. Create basic color swatch grid for color selection
2. Implement mode switcher (HEX, RGB, HSL)
3. Add ColorPicker child component with gradients and sliders
4. Implement opacity/alpha channel support

### Step 3: Implement Color Palette Generator
1. Create `useColorPalette` composable
2. Implement color theory algorithms (complementary, analogous, triadic, split-complementary)
3. Add palette generation modal with visual previews
4. Apply generated palette to all color slots

### Step 4: Add Accessibility Features
1. Create `useAccessibility` composable
2. Implement WCAG contrast ratio calculator
3. Build contrast checker UI with visual feedback
4. Add accessibility score indicator (AA/AAA/Fail)

### Step 5: Implement Preset Management
1. Create preset save functionality with name input
2. Store presets in localStorage
3. Build preset list UI with load/delete actions
4. Add visual preview of preset colors

### Step 6: Add Predefined Schemes
1. Create library of 10+ professional color schemes
2. Build scheme selection grid
3. Implement one-click scheme application
4. Add scheme previews

### Step 7: Build Export Functionality
1. Generate CSS custom properties from selected colors
2. Implement copy-to-clipboard functionality
3. Add download as .css file feature
4. Display live CSS preview

### Step 8: Integrate with Parent Component
1. Emit color update events to BrandingManager
2. Accept initial colors from props
3. Support dark mode detection
4. Ensure responsive design

### Step 9: Add Polish and UX Enhancements
1. Implement color history (last 10 colors)
2. Add smooth transitions and animations
3. Ensure keyboard navigation support
4. Add loading states and error handling

### Step 10: Testing and Refinement
1. Test all color theory algorithms for accuracy
2. Verify WCAG calculations against standards
3. Test preset persistence across sessions
4. Ensure mobile responsiveness

## Test Strategy

### Unit Tests (Vitest)

**File:** `resources/js/Components/Enterprise/WhiteLabel/__tests__/ThemeCustomizer.spec.js`

```javascript
import { mount } from '@vue/test-utils'
import { describe, it, expect } from 'vitest'
import ThemeCustomizer from '../ThemeCustomizer.vue'

describe('ThemeCustomizer.vue', () => {
  it('renders color grid with all color slots', () => {
    const wrapper = mount(ThemeCustomizer, {
      props: {
        initialColors: {
          primary: '#3b82f6',
          secondary: '#10b981',
          accent: '#f59e0b',
          text: '#1f2937',
          background: '#ffffff',
        }
      }
    })

    expect(wrapper.findAll('.color-swatch')).toHaveLength(5)
  })

  it('updates color when swatch is clicked', async () => {
    const wrapper = mount(ThemeCustomizer)

    await wrapper.find('.color-swatch').trigger('click')

    expect(wrapper.vm.activeColor).toBe('primary')
  })

  it('emits update:colors event when color changes', async () => {
    const wrapper = mount(ThemeCustomizer)

    wrapper.vm.updateColor('primary', '#ff0000')

    expect(wrapper.emitted('update:colors')).toBeTruthy()
    expect(wrapper.emitted('update:colors')[0][0].primary).toBe('#ff0000')
  })

  it('generates complementary color palette correctly', () => {
    const wrapper = mount(ThemeCustomizer, {
      props: {
        initialColors: {
          primary: '#3b82f6',
        }
      }
    })

    wrapper.vm.generatePaletteFromPrimary('complementary')

    // Verify complementary color is opposite on color wheel
    expect(wrapper.vm.colors.primary).toBe('#3b82f6')
    expect(wrapper.vm.colors.secondary).toMatch(/^#[0-9a-f]{6}$/i)
  })

  it('saves preset to localStorage', () => {
    const wrapper = mount(ThemeCustomizer)

    wrapper.vm.savePreset('Test Preset')

    expect(wrapper.vm.presets).toHaveLength(1)
    expect(wrapper.vm.presets[0].name).toBe('Test Preset')
  })

  it('loads preset and updates colors', async () => {
    const wrapper = mount(ThemeCustomizer)

    const preset = {
      id: 1,
      name: 'Test',
      colors: {
        primary: '#ff0000',
        secondary: '#00ff00',
      }
    }

    wrapper.vm.loadPreset(preset)

    expect(wrapper.vm.colors.primary).toBe('#ff0000')
    expect(wrapper.emitted('update:colors')).toBeTruthy()
  })

  it('calculates contrast ratio correctly', () => {
    const wrapper = mount(ThemeCustomizer)

    const result = wrapper.vm.checkContrast('#000000', '#ffffff')

    expect(result.ratio).toBeCloseTo(21, 0) // Perfect contrast
    expect(result.wcag).toBe('AAA')
  })

  it('exports CSS variables in correct format', () => {
    const wrapper = mount(ThemeCustomizer, {
      props: {
        initialColors: {
          primary: '#3b82f6',
          secondary: '#10b981',
        }
      }
    })

    expect(wrapper.vm.cssVariables).toContain('--color-primary: #3b82f6')
    expect(wrapper.vm.cssVariables).toContain('--color-secondary: #10b981')
  })

  it('adds colors to history when updated', () => {
    const wrapper = mount(ThemeCustomizer)

    wrapper.vm.updateColor('primary', '#ff0000')
    wrapper.vm.updateColor('secondary', '#00ff00')

    expect(wrapper.vm.colorHistory).toContain('#ff0000')
    expect(wrapper.vm.colorHistory).toContain('#00ff00')
  })

  it('limits color history to 10 items', () => {
    const wrapper = mount(ThemeCustomizer)

    for (let i = 0; i < 15; i++) {
      wrapper.vm.updateColor('primary', `#00000${i}`)
    }

    expect(wrapper.vm.colorHistory.length).toBeLessThanOrEqual(10)
  })

  it('applies predefined color scheme', () => {
    const wrapper = mount(ThemeCustomizer)

    const scheme = {
      name: 'Ocean Blue',
      colors: {
        primary: '#0ea5e9',
        secondary: '#06b6d4',
      }
    }

    wrapper.vm.applyPredefinedScheme(scheme)

    expect(wrapper.vm.colors.primary).toBe('#0ea5e9')
    expect(wrapper.vm.colors.secondary).toBe('#06b6d4')
  })
})
```

### Composable Tests

**File:** `resources/js/Composables/__tests__/useColorPalette.spec.js`

```javascript
import { describe, it, expect } from 'vitest'
import { useColorPalette } from '../useColorPalette'

describe('useColorPalette', () => {
  const { hexToHSL, hslToHex, generatePalette } = useColorPalette()

  it('converts hex to HSL correctly', () => {
    const hsl = hexToHSL('#3b82f6')

    expect(hsl.h).toBeGreaterThanOrEqual(0)
    expect(hsl.h).toBeLessThanOrEqual(360)
    expect(hsl.s).toBeGreaterThanOrEqual(0)
    expect(hsl.s).toBeLessThanOrEqual(100)
    expect(hsl.l).toBeGreaterThanOrEqual(0)
    expect(hsl.l).toBeLessThanOrEqual(100)
  })

  it('converts HSL to hex correctly', () => {
    const hex = hslToHex(217, 91, 60)

    expect(hex).toMatch(/^#[0-9a-f]{6}$/i)
  })

  it('generates complementary palette', () => {
    const palette = generatePalette('#3b82f6', 'complementary')

    expect(palette).toHaveProperty('primary')
    expect(palette).toHaveProperty('secondary')
    expect(palette).toHaveProperty('accent')
  })

  it('generates analogous palette', () => {
    const palette = generatePalette('#3b82f6', 'analogous')

    expect(palette.primary).toBe('#3b82f6')
    expect(palette.secondary).toMatch(/^#[0-9a-f]{6}$/i)
    expect(palette.accent).toMatch(/^#[0-9a-f]{6}$/i)
  })
})
```

**File:** `resources/js/Composables/__tests__/useAccessibility.spec.js`

```javascript
import { describe, it, expect } from 'vitest'
import { useAccessibility } from '../useAccessibility'

describe('useAccessibility', () => {
  const { getLuminance, getContrastRatio, checkContrast } = useAccessibility()

  it('calculates luminance correctly', () => {
    const whiteLum = getLuminance('#ffffff')
    const blackLum = getLuminance('#000000')

    expect(whiteLum).toBeGreaterThan(blackLum)
  })

  it('calculates contrast ratio for black on white', () => {
    const ratio = getContrastRatio('#000000', '#ffffff')

    expect(ratio).toBeCloseTo(21, 0)
  })

  it('checks WCAG AAA compliance', () => {
    const result = checkContrast('#000000', '#ffffff')

    expect(result.wcag).toBe('AAA')
    expect(result.passAAA).toBe(true)
  })

  it('checks WCAG AA compliance', () => {
    const result = checkContrast('#767676', '#ffffff')

    expect(result.wcag).toBe('AA')
    expect(result.passAA).toBe(true)
  })

  it('detects failing contrast', () => {
    const result = checkContrast('#dddddd', '#ffffff')

    expect(result.wcag).toBe('Fail')
    expect(result.passAA).toBe(false)
  })
})
```

### Integration Tests (Pest)

**File:** `tests/Feature/Enterprise/ThemeCustomizationTest.php`

```php
<?php

use App\Models\Organization;
use App\Models\User;
use Inertia\Testing\AssertableInertia as Assert;

it('renders theme customizer component', function () {
    $organization = Organization::factory()->create();
    $user = User::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    $this->actingAs($user)
        ->get(route('enterprise.branding', $organization))
        ->assertInertia(fn (Assert $page) => $page
            ->component('Enterprise/Organization/Branding')
            ->has('whiteLabelConfig')
            ->has('availableFonts')
        );
});

it('persists theme customizations', function () {
    $organization = Organization::factory()->create();
    $user = User::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    $colors = [
        'primary_color' => '#3b82f6',
        'secondary_color' => '#10b981',
        'accent_color' => '#f59e0b',
    ];

    $this->actingAs($user)
        ->put(route('enterprise.whitelabel.update', $organization), $colors)
        ->assertRedirect();

    $config = $organization->whiteLabelConfig;
    expect($config->primary_color)->toBe('#3b82f6');
});
```

### Browser Tests (Dusk)

```php
it('allows color customization workflow', function () {
    $this->browse(function (Browser $browser) {
        $browser->loginAs($user)
            ->visit('/enterprise/organizations/1/branding')
            ->waitFor('.theme-customizer')

            // Select primary color
            ->click('.color-swatch[data-color="primary"]')
            ->assertSeeIn('.color-swatch-label', 'primary')

            // Generate complementary palette
            ->click('button:contains("Generate Palette")')
            ->waitFor('.palette-modal')
            ->click('.palette-option:contains("Complementary")')
            ->waitUntilMissing('.palette-modal')

            // Verify colors updated
            ->assertVisible('.color-swatch')

            // Save preset
            ->click('button:contains("Save Current")')
            ->waitForDialog()
            ->typeInDialog('My Custom Theme')
            ->acceptDialog()
            ->waitForText('My Custom Theme')

            // Export CSS
            ->click('button:contains("Export CSS")')
            ->waitForText('Copied to clipboard');
    });
});
```

## Definition of Done

- [ ] ThemeCustomizer.vue component created with Composition API
- [ ] Advanced color picker with HEX, RGB, HSL modes implemented
- [ ] Color palette generator with 4+ algorithms (complementary, analogous, triadic, split-complementary)
- [ ] useColorPalette composable created and tested
- [ ] useAccessibility composable created and tested
- [ ] Contrast ratio calculator implemented with WCAG compliance checking
- [ ] Accessibility score display (AA/AAA/Fail) working
- [ ] Preset management (save, load, delete) implemented
- [ ] Preset persistence in localStorage working
- [ ] Predefined color schemes library with 10+ schemes
- [ ] CSS variables generation and export functionality
- [ ] Copy to clipboard feature working
- [ ] Download as .css file feature working
- [ ] Color history tracking (last 10 colors)
- [ ] Recent colors display and selection
- [ ] Integration with BrandingManager via events
- [ ] Responsive design for tablet and desktop
- [ ] Dark mode support for component itself
- [ ] Unit tests for component (15+ tests, >90% coverage)
- [ ] Unit tests for composables (10+ tests each)
- [ ] Integration tests for color persistence (5+ tests)
- [ ] Browser test for full workflow
- [ ] Accessibility compliance (keyboard navigation, ARIA labels)
- [ ] Code reviewed and approved
- [ ] Documentation updated with usage examples
- [ ] No console errors or warnings
- [ ] Performance verified (smooth color updates, no lag)

## Related Tasks

- **Integrates with:** Task 5 (BrandingManager.vue parent component)
- **Integrates with:** Task 8 (BrandingPreview.vue for live preview)
- **Integrates with:** Task 2 (DynamicAssetController for CSS compilation)
- **Uses:** Task 3 (Redis caching for compiled CSS)
- **Used by:** Task 9 (Email templates use selected colors)
