---
name: Build ApiKeyManager.vue for token creation
status: open
created: 2025-10-06T15:23:47Z
updated: 2025-10-06T20:39:13Z
github: https://github.com/johnproblems/topgun/issues/167
depends_on: [52]
parallel: true
conflicts_with: []
---

# Task: Build ApiKeyManager.vue for token creation

## Description

Create a comprehensive Vue.js 3 component for managing API tokens within the Coolify Enterprise platform. This component provides organization administrators and developers with a secure, intuitive interface to create, view, manage, and revoke Sanctum-based API tokens with granular ability permissions, organization scoping, and security features.

The ApiKeyManager.vue component is the frontend interface for the enhanced API system, enabling users to:
1. **Generate new API tokens** with custom names and expiration dates
2. **Configure granular permissions** using Laravel Sanctum's ability system
3. **View existing tokens** with usage statistics and last-used timestamps
4. **Revoke tokens** with confirmation dialogs to prevent accidental deletion
5. **Copy tokens securely** with clipboard integration and one-time display
6. **Filter and search** tokens by name, abilities, and creation date
7. **Monitor token usage** with integration to ApiUsageMonitoring.vue (Task 60)

**Integration with Enterprise Architecture:**
- **Backend:** Extends Laravel Sanctum tokens with organization context (Task 52)
- **Middleware:** Works with ApiOrganizationScope middleware for automatic organization scoping (Task 53)
- **Rate Limiting:** Displays tier-based rate limits from enterprise licenses (Task 54)
- **Security:** Enforces token creation limits based on license tier (Starter: 5 tokens, Pro: 25 tokens, Enterprise: unlimited)

**Key Features:**
- **Ability Selection Interface:** Checkboxes for granular permission control (e.g., `server:read`, `server:write`, `application:deploy`)
- **Token Security:** One-time display with warning, secure clipboard copy, automatic expiration
- **Organization Scoping:** All tokens automatically scoped to current organization context
- **Accessibility:** Full keyboard navigation, ARIA labels, screen reader support
- **Real-time Updates:** WebSocket integration for token usage statistics
- **Responsive Design:** Mobile-friendly interface with touch-optimized controls

**Why this task is important:** API tokens are the primary authentication method for programmatic access to Coolify Enterprise. A well-designed token management interface ensures developers can securely integrate Coolify into their CI/CD pipelines, automation scripts, and third-party tools while maintaining proper security boundaries. Poor token management leads to security vulnerabilities (overly permissive tokens, forgotten revocations) and developer friction (unclear permissions, difficult renewal process). This component balances security with usability, following industry best practices from GitHub, AWS IAM, and Stripe's API key management patterns.

## Acceptance Criteria

- [ ] Component renders API token list with name, abilities, created date, last used, expiration status
- [ ] "Create New Token" form with fields: name, abilities (checkboxes), expiration date (optional), rate limit tier display
- [ ] Token creation displays new token ONCE with prominent warning: "Save this token now. You won't be able to see it again."
- [ ] Secure clipboard copy with visual feedback (checkmark icon, "Copied!" message)
- [ ] Token revocation with confirmation dialog showing token name and usage statistics
- [ ] Ability selection grouped by resource type (e.g., Servers, Applications, Databases, Infrastructure)
- [ ] Pre-defined ability templates: Read-Only, Read-Write, Deploy-Only, Full Access
- [ ] Token expiration validation (max 1 year for non-enterprise tiers, unlimited for enterprise)
- [ ] License-based token count enforcement (Starter: 5, Pro: 25, Enterprise: unlimited)
- [ ] Search and filter functionality (by name, abilities, active/expired status)
- [ ] Integration with ApiUsageMonitoring.vue for token-specific usage graphs
- [ ] Error handling for API failures, network errors, permission denials
- [ ] Loading states for all async operations (create, list, revoke)
- [ ] Responsive design working on mobile, tablet, desktop
- [ ] Dark mode support following Coolify's design system
- [ ] Accessibility compliance: ARIA labels, keyboard navigation, screen reader announcements
- [ ] Real-time updates when tokens are created/revoked in other sessions

## Technical Details

### File Paths

**Vue Component:**
- `/home/topgun/topgun/resources/js/Components/Enterprise/Api/ApiKeyManager.vue`

**Related Components:**
- `/home/topgun/topgun/resources/js/Components/Enterprise/Api/TokenAbilitySelector.vue` (new - ability checkbox grid)
- `/home/topgun/topgun/resources/js/Components/Enterprise/Api/TokenCreationDialog.vue` (new - modal for token creation)
- `/home/topgun/topgun/resources/js/Components/Enterprise/Api/TokenDisplayDialog.vue` (new - one-time token display)
- `/home/topgun/topgun/resources/js/Components/Enterprise/Api/TokenRevokeConfirmation.vue` (new - revoke confirmation)

**Backend Integration:**
- `/home/topgun/topgun/app/Http/Controllers/Enterprise/ApiTokenController.php` (existing from Task 52)
- `/home/topgun/topgun/app/Models/User.php` (Sanctum token methods)
- `/home/topgun/topgun/routes/web.php` (Inertia routes for token management pages)

**Composables:**
- `/home/topgun/topgun/resources/js/Composables/useApiTokens.js` (new - API token management logic)
- `/home/topgun/topgun/resources/js/Composables/useClipboard.js` (new - secure clipboard operations)

### Component Architecture

#### Main Component Structure

**File:** `resources/js/Components/Enterprise/Api/ApiKeyManager.vue`

```vue
<script setup>
import { ref, computed, onMounted } from 'vue'
import { useForm, usePage } from '@inertiajs/vue3'
import { useApiTokens } from '@/Composables/useApiTokens'
import { useClipboard } from '@/Composables/useClipboard'
import TokenAbilitySelector from './TokenAbilitySelector.vue'
import TokenCreationDialog from './TokenCreationDialog.vue'
import TokenDisplayDialog from './TokenDisplayDialog.vue'
import TokenRevokeConfirmation from './TokenRevokeConfirmation.vue'

const props = defineProps({
  organization: {
    type: Object,
    required: true,
  },
  existingTokens: {
    type: Array,
    default: () => [],
  },
  availableAbilities: {
    type: Array,
    required: true,
  },
  license: {
    type: Object,
    required: true,
  },
  rateLimits: {
    type: Object,
    required: true,
  },
})

// Composables
const { tokens, createToken, revokeToken, refreshTokens, isLoading } = useApiTokens(props.organization)
const { copyToClipboard, isCopied } = useClipboard()
const page = usePage()

// State
const showCreateDialog = ref(false)
const showTokenDisplay = ref(false)
const showRevokeDialog = ref(false)
const newlyCreatedToken = ref(null)
const selectedToken = ref(null)
const searchQuery = ref('')
const filterStatus = ref('all') // all, active, expired

// Computed
const tokenLimit = computed(() => {
  const tier = props.license.tier
  if (tier === 'enterprise') return null // unlimited
  if (tier === 'pro') return 25
  return 5 // starter
})

const canCreateMoreTokens = computed(() => {
  if (!tokenLimit.value) return true // unlimited
  return tokens.value.length < tokenLimit.value
})

const filteredTokens = computed(() => {
  let result = tokens.value

  // Search filter
  if (searchQuery.value) {
    const query = searchQuery.value.toLowerCase()
    result = result.filter(token =>
      token.name.toLowerCase().includes(query) ||
      token.abilities.some(ability => ability.toLowerCase().includes(query))
    )
  }

  // Status filter
  if (filterStatus.value === 'active') {
    result = result.filter(token => !token.is_expired)
  } else if (filterStatus.value === 'expired') {
    result = result.filter(token => token.is_expired)
  }

  return result
})

const groupedAbilities = computed(() => {
  const groups = {}
  props.availableAbilities.forEach(ability => {
    const [resource] = ability.split(':')
    if (!groups[resource]) {
      groups[resource] = []
    }
    groups[resource].push(ability)
  })
  return groups
})

// Methods
const handleCreateToken = async (formData) => {
  try {
    const response = await createToken(formData)

    if (response.token) {
      newlyCreatedToken.value = response
      showCreateDialog.value = false
      showTokenDisplay.value = true
      await refreshTokens()
    }
  } catch (error) {
    console.error('Token creation failed:', error)
    // Error handled in composable
  }
}

const handleRevokeToken = async (token) => {
  selectedToken.value = token
  showRevokeDialog.value = true
}

const confirmRevoke = async () => {
  if (!selectedToken.value) return

  try {
    await revokeToken(selectedToken.value.id)
    showRevokeDialog.value = false
    selectedToken.value = null
    await refreshTokens()
  } catch (error) {
    console.error('Token revocation failed:', error)
  }
}

const copyToken = async (token) => {
  await copyToClipboard(token)
}

const formatDate = (dateString) => {
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
  })
}

const formatAbilities = (abilities) => {
  if (abilities.includes('*')) return 'Full Access'
  return abilities.slice(0, 3).join(', ') + (abilities.length > 3 ? ` +${abilities.length - 3}` : '')
}

// Lifecycle
onMounted(async () => {
  await refreshTokens()
})
</script>

<template>
  <div class="api-key-manager">
    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <h2 class="text-2xl font-bold">API Tokens</h2>
        <p class="text-gray-600 dark:text-gray-400 mt-1">
          Manage API tokens for programmatic access to your organization's resources
        </p>
      </div>

      <button
        v-if="canCreateMoreTokens"
        type="button"
        class="btn btn-primary"
        @click="showCreateDialog = true"
      >
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Create Token
      </button>

      <div v-else class="token-limit-warning">
        <svg class="w-5 h-5 text-amber-500" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
        <span class="ml-2">Token limit reached ({{ tokens.length }}/{{ tokenLimit }})</span>
        <a href="#" class="ml-2 text-blue-600 hover:underline">Upgrade to create more</a>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters">
      <div class="search-box">
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <input
          v-model="searchQuery"
          type="text"
          placeholder="Search tokens by name or ability..."
          class="search-input"
        />
      </div>

      <div class="status-filter">
        <button
          :class="['filter-btn', { active: filterStatus === 'all' }]"
          @click="filterStatus = 'all'"
        >
          All
        </button>
        <button
          :class="['filter-btn', { active: filterStatus === 'active' }]"
          @click="filterStatus = 'active'"
        >
          Active
        </button>
        <button
          :class="['filter-btn', { active: filterStatus === 'expired' }]"
          @click="filterStatus = 'expired'"
        >
          Expired
        </button>
      </div>
    </div>

    <!-- Token List -->
    <div v-if="isLoading" class="loading-state">
      <div class="spinner" />
      <p>Loading tokens...</p>
    </div>

    <div v-else-if="filteredTokens.length === 0" class="empty-state">
      <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
      </svg>
      <h3>No tokens found</h3>
      <p>Create your first API token to get started with programmatic access</p>
      <button
        v-if="canCreateMoreTokens"
        type="button"
        class="btn btn-primary mt-4"
        @click="showCreateDialog = true"
      >
        Create Token
      </button>
    </div>

    <div v-else class="token-grid">
      <div
        v-for="token in filteredTokens"
        :key="token.id"
        class="token-card"
        :class="{ 'token-expired': token.is_expired }"
      >
        <div class="token-header">
          <div class="token-name">
            <h3>{{ token.name }}</h3>
            <span v-if="token.is_expired" class="badge badge-danger">Expired</span>
            <span v-else class="badge badge-success">Active</span>
          </div>

          <div class="token-actions">
            <button
              type="button"
              class="btn-icon"
              title="View Usage"
              @click="$emit('view-usage', token)"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
            </button>

            <button
              type="button"
              class="btn-icon btn-danger"
              title="Revoke Token"
              @click="handleRevokeToken(token)"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </button>
          </div>
        </div>

        <div class="token-details">
          <div class="detail-row">
            <span class="detail-label">Abilities:</span>
            <span class="detail-value">{{ formatAbilities(token.abilities) }}</span>
          </div>

          <div class="detail-row">
            <span class="detail-label">Created:</span>
            <span class="detail-value">{{ formatDate(token.created_at) }}</span>
          </div>

          <div class="detail-row">
            <span class="detail-label">Last used:</span>
            <span class="detail-value">
              {{ token.last_used_at ? formatDate(token.last_used_at) : 'Never' }}
            </span>
          </div>

          <div v-if="token.expires_at" class="detail-row">
            <span class="detail-label">Expires:</span>
            <span class="detail-value" :class="{ 'text-red-600': token.is_expired }">
              {{ formatDate(token.expires_at) }}
            </span>
          </div>

          <div class="detail-row">
            <span class="detail-label">Rate Limit:</span>
            <span class="detail-value">
              {{ rateLimits[license.tier] }} requests/minute
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Token Creation Dialog -->
    <TokenCreationDialog
      v-if="showCreateDialog"
      :organization="organization"
      :available-abilities="availableAbilities"
      :grouped-abilities="groupedAbilities"
      :license="license"
      @create="handleCreateToken"
      @close="showCreateDialog = false"
    />

    <!-- Token Display Dialog (One-time) -->
    <TokenDisplayDialog
      v-if="showTokenDisplay && newlyCreatedToken"
      :token="newlyCreatedToken"
      @copy="copyToken"
      @close="showTokenDisplay = false; newlyCreatedToken = null"
    />

    <!-- Token Revoke Confirmation -->
    <TokenRevokeConfirmation
      v-if="showRevokeDialog && selectedToken"
      :token="selectedToken"
      @confirm="confirmRevoke"
      @cancel="showRevokeDialog = false; selectedToken = null"
    />
  </div>
</template>

<style scoped>
.api-key-manager {
  @apply space-y-6;
}

.header {
  @apply flex justify-between items-start;
}

.header-content h2 {
  @apply text-2xl font-bold text-gray-900 dark:text-white;
}

.token-limit-warning {
  @apply flex items-center px-4 py-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg;
}

.filters {
  @apply flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between;
}

.search-box {
  @apply relative flex-1 max-w-md;
}

.search-icon {
  @apply absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400;
}

.search-input {
  @apply w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
         bg-white dark:bg-gray-800 text-gray-900 dark:text-white
         focus:ring-2 focus:ring-blue-500 focus:border-transparent;
}

.status-filter {
  @apply flex gap-2;
}

.filter-btn {
  @apply px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600
         bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300
         hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors;
}

.filter-btn.active {
  @apply bg-blue-50 dark:bg-blue-900/20 border-blue-500 text-blue-700 dark:text-blue-400;
}

.loading-state {
  @apply flex flex-col items-center justify-center py-12;
}

.spinner {
  @apply w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-4;
}

.empty-state {
  @apply flex flex-col items-center justify-center py-12 text-center;
}

.empty-icon {
  @apply w-16 h-16 text-gray-400 mb-4;
}

.empty-state h3 {
  @apply text-xl font-semibold text-gray-900 dark:text-white mb-2;
}

.empty-state p {
  @apply text-gray-600 dark:text-gray-400;
}

.token-grid {
  @apply grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4;
}

.token-card {
  @apply bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700
         rounded-lg p-6 hover:shadow-lg transition-shadow;
}

.token-card.token-expired {
  @apply opacity-60 border-red-300 dark:border-red-800;
}

.token-header {
  @apply flex justify-between items-start mb-4;
}

.token-name h3 {
  @apply text-lg font-semibold text-gray-900 dark:text-white mb-1;
}

.badge {
  @apply inline-block px-2 py-1 text-xs font-medium rounded;
}

.badge-success {
  @apply bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400;
}

.badge-danger {
  @apply bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400;
}

.token-actions {
  @apply flex gap-2;
}

.btn-icon {
  @apply p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors;
}

.btn-icon.btn-danger {
  @apply hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 dark:text-red-400;
}

.token-details {
  @apply space-y-2;
}

.detail-row {
  @apply flex justify-between items-center text-sm;
}

.detail-label {
  @apply text-gray-600 dark:text-gray-400 font-medium;
}

.detail-value {
  @apply text-gray-900 dark:text-white;
}
</style>
```

### Token Creation Dialog Component

**File:** `resources/js/Components/Enterprise/Api/TokenCreationDialog.vue`

```vue
<script setup>
import { ref, computed } from 'vue'
import TokenAbilitySelector from './TokenAbilitySelector.vue'

const props = defineProps({
  organization: Object,
  availableAbilities: Array,
  groupedAbilities: Object,
  license: Object,
})

const emit = defineEmits(['create', 'close'])

// Form state
const form = ref({
  name: '',
  abilities: [],
  expires_at: null,
  use_template: null,
})

const templates = [
  { id: 'read-only', name: 'Read Only', abilities: ['*:read', '*:list'] },
  { id: 'read-write', name: 'Read & Write', abilities: ['*:read', '*:write', '*:list'] },
  { id: 'deploy-only', name: 'Deploy Only', abilities: ['application:deploy', 'application:read'] },
  { id: 'full-access', name: 'Full Access', abilities: ['*'] },
]

const maxExpirationDays = computed(() => {
  return props.license.tier === 'enterprise' ? null : 365 // 1 year for non-enterprise
})

const applyTemplate = (template) => {
  form.value.use_template = template.id
  form.value.abilities = [...template.abilities]
}

const handleSubmit = () => {
  if (!form.value.name || form.value.abilities.length === 0) {
    return
  }

  emit('create', form.value)
}
</script>

<template>
  <div class="modal-overlay" @click.self="$emit('close')">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="text-xl font-bold">Create API Token</h3>
        <button type="button" class="btn-close" @click="$emit('close')">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <form @submit.prevent="handleSubmit">
        <div class="modal-body">
          <!-- Token Name -->
          <div class="form-group">
            <label for="token-name" class="form-label">Token Name</label>
            <input
              id="token-name"
              v-model="form.name"
              type="text"
              class="form-input"
              placeholder="e.g., CI/CD Pipeline, Mobile App, Monitoring Script"
              required
            />
            <p class="form-hint">A descriptive name to help you identify this token</p>
          </div>

          <!-- Template Selection -->
          <div class="form-group">
            <label class="form-label">Quick Templates</label>
            <div class="template-grid">
              <button
                v-for="template in templates"
                :key="template.id"
                type="button"
                class="template-btn"
                :class="{ active: form.use_template === template.id }"
                @click="applyTemplate(template)"
              >
                {{ template.name }}
              </button>
            </div>
          </div>

          <!-- Ability Selection -->
          <div class="form-group">
            <label class="form-label">Permissions</label>
            <TokenAbilitySelector
              v-model="form.abilities"
              :available-abilities="availableAbilities"
              :grouped-abilities="groupedAbilities"
            />
          </div>

          <!-- Expiration -->
          <div class="form-group">
            <label for="expires-at" class="form-label">Expiration Date (Optional)</label>
            <input
              id="expires-at"
              v-model="form.expires_at"
              type="date"
              class="form-input"
              :max="maxExpirationDays ? new Date(Date.now() + maxExpirationDays * 86400000).toISOString().split('T')[0] : null"
            />
            <p class="form-hint">
              {{ maxExpirationDays ? `Maximum expiration: ${maxExpirationDays} days` : 'No expiration limit for Enterprise tier' }}
            </p>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" @click="$emit('close')">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" :disabled="!form.name || form.abilities.length === 0">
            Create Token
          </button>
        </div>
      </form>
    </div>
  </div>
</template>

<style scoped>
.modal-overlay {
  @apply fixed inset-0 bg-black/50 flex items-center justify-center z-50;
}

.modal-content {
  @apply bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto;
}

.modal-header {
  @apply flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700;
}

.btn-close {
  @apply text-gray-400 hover:text-gray-600 dark:hover:text-gray-300;
}

.modal-body {
  @apply p-6 space-y-6;
}

.modal-footer {
  @apply flex justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700;
}

.form-group {
  @apply space-y-2;
}

.form-label {
  @apply block text-sm font-medium text-gray-700 dark:text-gray-300;
}

.form-input {
  @apply w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
         bg-white dark:bg-gray-900 text-gray-900 dark:text-white
         focus:ring-2 focus:ring-blue-500 focus:border-transparent;
}

.form-hint {
  @apply text-sm text-gray-600 dark:text-gray-400;
}

.template-grid {
  @apply grid grid-cols-2 gap-3;
}

.template-btn {
  @apply px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg
         bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700
         transition-colors text-center;
}

.template-btn.active {
  @apply bg-blue-50 dark:bg-blue-900/20 border-blue-500 text-blue-700 dark:text-blue-400;
}
</style>
```

### Token Ability Selector Component

**File:** `resources/js/Components/Enterprise/Api/TokenAbilitySelector.vue`

```vue
<script setup>
import { computed } from 'vue'

const props = defineProps({
  modelValue: {
    type: Array,
    default: () => [],
  },
  availableAbilities: {
    type: Array,
    required: true,
  },
  groupedAbilities: {
    type: Object,
    required: true,
  },
})

const emit = defineEmits(['update:modelValue'])

const isSelected = (ability) => {
  return props.modelValue.includes(ability) || props.modelValue.includes('*')
}

const toggleAbility = (ability) => {
  let newAbilities = [...props.modelValue]

  if (ability === '*') {
    newAbilities = ['*']
  } else {
    // Remove wildcard if selecting specific ability
    newAbilities = newAbilities.filter(a => a !== '*')

    if (newAbilities.includes(ability)) {
      newAbilities = newAbilities.filter(a => a !== ability)
    } else {
      newAbilities.push(ability)
    }
  }

  emit('update:modelValue', newAbilities)
}

const selectAllInGroup = (group) => {
  const groupAbilities = props.groupedAbilities[group]
  let newAbilities = [...props.modelValue].filter(a => a !== '*')

  const allSelected = groupAbilities.every(a => newAbilities.includes(a))

  if (allSelected) {
    // Deselect all in group
    newAbilities = newAbilities.filter(a => !groupAbilities.includes(a))
  } else {
    // Select all in group
    groupAbilities.forEach(ability => {
      if (!newAbilities.includes(ability)) {
        newAbilities.push(ability)
      }
    })
  }

  emit('update:modelValue', newAbilities)
}

const isGroupFullySelected = (group) => {
  if (props.modelValue.includes('*')) return true
  const groupAbilities = props.groupedAbilities[group]
  return groupAbilities.every(a => props.modelValue.includes(a))
}
</script>

<template>
  <div class="ability-selector">
    <!-- Full Access Option -->
    <div class="ability-group">
      <label class="ability-checkbox ability-checkbox-full">
        <input
          type="checkbox"
          :checked="modelValue.includes('*')"
          @change="toggleAbility('*')"
        />
        <span class="ability-label">
          <strong>Full Access</strong>
          <span class="text-sm text-gray-600 dark:text-gray-400">All permissions (use with caution)</span>
        </span>
      </label>
    </div>

    <!-- Grouped Abilities -->
    <div v-for="(abilities, group) in groupedAbilities" :key="group" class="ability-group">
      <div class="ability-group-header">
        <h4 class="ability-group-title">{{ group.charAt(0).toUpperCase() + group.slice(1) }}</h4>
        <button
          type="button"
          class="btn-select-all"
          @click="selectAllInGroup(group)"
        >
          {{ isGroupFullySelected(group) ? 'Deselect All' : 'Select All' }}
        </button>
      </div>

      <div class="ability-list">
        <label
          v-for="ability in abilities"
          :key="ability"
          class="ability-checkbox"
        >
          <input
            type="checkbox"
            :checked="isSelected(ability)"
            :disabled="modelValue.includes('*')"
            @change="toggleAbility(ability)"
          />
          <span class="ability-label">{{ ability }}</span>
        </label>
      </div>
    </div>
  </div>
</template>

<style scoped>
.ability-selector {
  @apply space-y-4 max-h-96 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg p-4;
}

.ability-group {
  @apply space-y-2;
}

.ability-group-header {
  @apply flex justify-between items-center mb-2;
}

.ability-group-title {
  @apply font-semibold text-gray-900 dark:text-white;
}

.btn-select-all {
  @apply text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300;
}

.ability-list {
  @apply space-y-2 pl-4;
}

.ability-checkbox {
  @apply flex items-center gap-3 cursor-pointer;
}

.ability-checkbox-full {
  @apply p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg;
}

.ability-checkbox input[type="checkbox"] {
  @apply w-5 h-5 text-blue-600 rounded border-gray-300 dark:border-gray-600
         focus:ring-2 focus:ring-blue-500;
}

.ability-checkbox input[type="checkbox"]:disabled {
  @apply opacity-50 cursor-not-allowed;
}

.ability-label {
  @apply text-sm text-gray-700 dark:text-gray-300;
}
</style>
```

### Token Display Dialog (One-time)

**File:** `resources/js/Components/Enterprise/Api/TokenDisplayDialog.vue`

```vue
<script setup>
import { ref } from 'vue'
import { useClipboard } from '@/Composables/useClipboard'

const props = defineProps({
  token: {
    type: Object,
    required: true,
  },
})

const emit = defineEmits(['copy', 'close'])

const { copyToClipboard, isCopied } = useClipboard()

const handleCopy = async () => {
  await copyToClipboard(props.token.plainTextToken)
  emit('copy', props.token.plainTextToken)
}
</script>

<template>
  <div class="modal-overlay" @click.self="$emit('close')">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="text-xl font-bold">Token Created Successfully</h3>
      </div>

      <div class="modal-body">
        <!-- Warning Banner -->
        <div class="warning-banner">
          <svg class="w-6 h-6 text-amber-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
          </svg>
          <div>
            <p class="font-semibold">Save this token now!</p>
            <p class="text-sm">For security reasons, you won't be able to view this token again. Store it in a secure location.</p>
          </div>
        </div>

        <!-- Token Display -->
        <div class="token-display">
          <div class="token-value">
            <code>{{ token.plainTextToken }}</code>
          </div>
          <button
            type="button"
            class="btn-copy"
            @click="handleCopy"
          >
            <svg v-if="!isCopied" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
            <svg v-else class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span>{{ isCopied ? 'Copied!' : 'Copy' }}</span>
          </button>
        </div>

        <!-- Token Details -->
        <div class="token-info">
          <div class="info-row">
            <span class="info-label">Token Name:</span>
            <span class="info-value">{{ token.name }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Abilities:</span>
            <span class="info-value">{{ token.abilities.join(', ') }}</span>
          </div>
          <div v-if="token.expires_at" class="info-row">
            <span class="info-label">Expires:</span>
            <span class="info-value">{{ new Date(token.expires_at).toLocaleDateString() }}</span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary" @click="$emit('close')">
          I've Saved the Token
        </button>
      </div>
    </div>
  </div>
</template>

<style scoped>
.modal-overlay {
  @apply fixed inset-0 bg-black/50 flex items-center justify-center z-50;
}

.modal-content {
  @apply bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full;
}

.modal-header {
  @apply p-6 border-b border-gray-200 dark:border-gray-700;
}

.modal-body {
  @apply p-6 space-y-4;
}

.modal-footer {
  @apply flex justify-end p-6 border-t border-gray-200 dark:border-gray-700;
}

.warning-banner {
  @apply flex gap-4 p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg;
}

.token-display {
  @apply flex gap-2;
}

.token-value {
  @apply flex-1 p-3 bg-gray-100 dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg overflow-x-auto;
}

.token-value code {
  @apply text-sm font-mono text-gray-900 dark:text-white;
}

.btn-copy {
  @apply flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg
         hover:bg-blue-700 transition-colors;
}

.token-info {
  @apply space-y-2 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg;
}

.info-row {
  @apply flex justify-between items-center;
}

.info-label {
  @apply text-sm font-medium text-gray-600 dark:text-gray-400;
}

.info-value {
  @apply text-sm text-gray-900 dark:text-white;
}
</style>
```

### Composable: useApiTokens

**File:** `resources/js/Composables/useApiTokens.js`

```javascript
import { ref } from 'vue'
import { router } from '@inertiajs/vue3'
import axios from 'axios'

export function useApiTokens(organization) {
  const tokens = ref([])
  const isLoading = ref(false)
  const error = ref(null)

  const refreshTokens = async () => {
    isLoading.value = true
    error.value = null

    try {
      const response = await axios.get(`/api/organizations/${organization.id}/tokens`)
      tokens.value = response.data.tokens
    } catch (err) {
      error.value = err.response?.data?.message || 'Failed to load tokens'
      console.error('Token refresh failed:', err)
    } finally {
      isLoading.value = false
    }
  }

  const createToken = async (formData) => {
    isLoading.value = true
    error.value = null

    try {
      const response = await axios.post(
        `/api/organizations/${organization.id}/tokens`,
        formData
      )
      return response.data
    } catch (err) {
      error.value = err.response?.data?.message || 'Failed to create token'
      throw err
    } finally {
      isLoading.value = false
    }
  }

  const revokeToken = async (tokenId) => {
    isLoading.value = true
    error.value = null

    try {
      await axios.delete(`/api/organizations/${organization.id}/tokens/${tokenId}`)
    } catch (err) {
      error.value = err.response?.data?.message || 'Failed to revoke token'
      throw err
    } finally {
      isLoading.value = false
    }
  }

  return {
    tokens,
    isLoading,
    error,
    refreshTokens,
    createToken,
    revokeToken,
  }
}
```

### Composable: useClipboard

**File:** `resources/js/Composables/useClipboard.js`

```javascript
import { ref } from 'vue'

export function useClipboard() {
  const isCopied = ref(false)

  const copyToClipboard = async (text) => {
    try {
      await navigator.clipboard.writeText(text)
      isCopied.value = true

      setTimeout(() => {
        isCopied.value = false
      }, 2000)
    } catch (err) {
      console.error('Failed to copy:', err)
    }
  }

  return {
    isCopied,
    copyToClipboard,
  }
}
```

### Backend Controller (Reference)

**File:** `app/Http/Controllers/Enterprise/ApiTokenController.php` (from Task 52)

```php
<?php

namespace App\Http\Controllers\Enterprise;

use App\Http\Controllers\Controller;
use App\Models\Organization;
use Illuminate\Http\Request;
use Illuminate\Support\Str;
use Inertia\Inertia;

class ApiTokenController extends Controller
{
    /**
     * Display API tokens management page
     */
    public function index(Organization $organization)
    {
        $this->authorize('view', $organization);

        return Inertia::render('Enterprise/Api/TokenManagement', [
            'organization' => $organization,
            'existingTokens' => $organization->tokens()->where('tokenable_type', 'App\\Models\\Organization')->get(),
            'availableAbilities' => $this->getAvailableAbilities(),
            'license' => $organization->license,
            'rateLimits' => [
                'starter' => 100,
                'pro' => 500,
                'enterprise' => 2000,
            ],
        ]);
    }

    /**
     * Create new API token
     */
    public function store(Request $request, Organization $organization)
    {
        $this->authorize('update', $organization);

        $validated = $request->validate([
            'name' => 'required|string|max:255',
            'abilities' => 'required|array|min:1',
            'abilities.*' => 'string',
            'expires_at' => 'nullable|date|after:now',
        ]);

        // Enforce token limits based on license tier
        $tokenLimit = $this->getTokenLimit($organization->license);
        if ($tokenLimit !== null) {
            $currentCount = $organization->tokens()->count();
            if ($currentCount >= $tokenLimit) {
                return back()->withErrors(['token' => 'Token limit reached for your license tier']);
            }
        }

        $token = $organization->createToken(
            $validated['name'],
            $validated['abilities']
        );

        // Set expiration if provided
        if (isset($validated['expires_at'])) {
            $token->accessToken->update(['expires_at' => $validated['expires_at']]);
        }

        return response()->json([
            'token' => $token->accessToken,
            'plainTextToken' => $token->plainTextToken,
            'name' => $validated['name'],
            'abilities' => $validated['abilities'],
            'expires_at' => $validated['expires_at'] ?? null,
        ]);
    }

    /**
     * Revoke API token
     */
    public function destroy(Organization $organization, string $tokenId)
    {
        $this->authorize('update', $organization);

        $token = $organization->tokens()->findOrFail($tokenId);
        $token->delete();

        return response()->json(['message' => 'Token revoked successfully']);
    }

    /**
     * Get available API abilities
     */
    private function getAvailableAbilities(): array
    {
        return [
            // Servers
            'server:read',
            'server:write',
            'server:delete',
            'server:list',

            // Applications
            'application:read',
            'application:write',
            'application:deploy',
            'application:delete',
            'application:list',

            // Databases
            'database:read',
            'database:write',
            'database:backup',
            'database:delete',
            'database:list',

            // Infrastructure
            'infrastructure:provision',
            'infrastructure:read',
            'infrastructure:delete',

            // Organizations
            'organization:read',
            'organization:update',

            // Monitoring
            'monitoring:read',
            'monitoring:metrics',

            // Wildcard
            '*',
        ];
    }

    /**
     * Get token limit for license tier
     */
    private function getTokenLimit($license): ?int
    {
        if (!$license) return 5; // Default to starter

        return match($license->tier) {
            'enterprise' => null, // unlimited
            'pro' => 25,
            'starter' => 5,
            default => 5,
        };
    }
}
```

## Implementation Approach

### Step 1: Create Component Structure
1. Create component directory: `resources/js/Components/Enterprise/Api/`
2. Create main component: `ApiKeyManager.vue`
3. Create child components: `TokenCreationDialog.vue`, `TokenDisplayDialog.vue`, `TokenAbilitySelector.vue`, `TokenRevokeConfirmation.vue`
4. Create composables: `useApiTokens.js`, `useClipboard.js`

### Step 2: Implement Main Component
1. Set up Vue 3 Composition API with props and emits
2. Implement state management (tokens list, filters, dialogs)
3. Add token display with card grid layout
4. Implement search and filter functionality
5. Add loading and empty states

### Step 3: Build Token Creation Flow
1. Create TokenCreationDialog component with form validation
2. Implement TokenAbilitySelector with grouped checkboxes
3. Add template selection (Read-Only, Read-Write, Deploy-Only, Full Access)
4. Integrate with backend API endpoint for token creation
5. Handle success and error states

### Step 4: Implement Token Display
1. Create TokenDisplayDialog for one-time token display
2. Add prominent security warning banner
3. Implement secure clipboard copy with visual feedback
4. Add token details display (name, abilities, expiration)
5. Handle dialog close with confirmation

### Step 5: Add Token Revocation
1. Create TokenRevokeConfirmation component
2. Display token usage statistics in confirmation dialog
3. Integrate with backend revoke endpoint
4. Refresh token list after revocation
5. Add success/error notifications

### Step 6: Implement Composables
1. Create `useApiTokens.js` for token CRUD operations
2. Implement API calls with error handling
3. Create `useClipboard.js` for secure clipboard operations
4. Add clipboard success feedback with auto-reset

### Step 7: Add License Integration
1. Display token limits based on license tier
2. Enforce token count validation
3. Show upgrade prompt when limit reached
4. Display rate limits for current tier

### Step 8: Polish and Accessibility
1. Add Tailwind CSS styling with dark mode support
2. Implement responsive design for mobile/tablet/desktop
3. Add ARIA labels and roles
4. Implement keyboard navigation
5. Add loading animations and transitions

## Test Strategy

### Unit Tests (Vitest + Vue Test Utils)

**File:** `resources/js/Components/Enterprise/Api/__tests__/ApiKeyManager.spec.js`

```javascript
import { mount } from '@vue/test-utils'
import { describe, it, expect, vi } from 'vitest'
import ApiKeyManager from '../ApiKeyManager.vue'

describe('ApiKeyManager.vue', () => {
  const mockOrganization = {
    id: 1,
    name: 'Acme Corp',
  }

  const mockTokens = [
    {
      id: 1,
      name: 'CI/CD Pipeline',
      abilities: ['application:deploy', 'application:read'],
      created_at: '2024-01-01T00:00:00Z',
      last_used_at: '2024-01-15T12:00:00Z',
      expires_at: null,
      is_expired: false,
    },
    {
      id: 2,
      name: 'Monitoring Script',
      abilities: ['monitoring:read', 'monitoring:metrics'],
      created_at: '2024-01-05T00:00:00Z',
      last_used_at: null,
      expires_at: '2024-06-01T00:00:00Z',
      is_expired: false,
    },
  ]

  const mockLicense = {
    tier: 'pro',
  }

  const mockRateLimits = {
    starter: 100,
    pro: 500,
    enterprise: 2000,
  }

  it('renders token list correctly', () => {
    const wrapper = mount(ApiKeyManager, {
      props: {
        organization: mockOrganization,
        existingTokens: mockTokens,
        availableAbilities: ['server:read', 'application:deploy'],
        license: mockLicense,
        rateLimits: mockRateLimits,
      },
    })

    expect(wrapper.text()).toContain('CI/CD Pipeline')
    expect(wrapper.text()).toContain('Monitoring Script')
  })

  it('displays token limit warning when limit reached', () => {
    const wrapper = mount(ApiKeyManager, {
      props: {
        organization: mockOrganization,
        existingTokens: Array(25).fill(mockTokens[0]), // Pro tier limit
        availableAbilities: [],
        license: mockLicense,
        rateLimits: mockRateLimits,
      },
    })

    expect(wrapper.text()).toContain('Token limit reached')
  })

  it('filters tokens by search query', async () => {
    const wrapper = mount(ApiKeyManager, {
      props: {
        organization: mockOrganization,
        existingTokens: mockTokens,
        availableAbilities: [],
        license: mockLicense,
        rateLimits: mockRateLimits,
      },
    })

    const searchInput = wrapper.find('input[type="text"]')
    await searchInput.setValue('CI/CD')

    // Should only show CI/CD Pipeline token
    expect(wrapper.text()).toContain('CI/CD Pipeline')
    expect(wrapper.text()).not.toContain('Monitoring Script')
  })

  it('filters tokens by status (active/expired)', async () => {
    const expiredToken = {
      ...mockTokens[0],
      is_expired: true,
    }

    const wrapper = mount(ApiKeyManager, {
      props: {
        organization: mockOrganization,
        existingTokens: [mockTokens[0], expiredToken],
        availableAbilities: [],
        license: mockLicense,
        rateLimits: mockRateLimits,
      },
    })

    // Click "Active" filter
    const activeBtn = wrapper.findAll('.filter-btn').find(btn => btn.text() === 'Active')
    await activeBtn.trigger('click')

    // Should only show active tokens
    const tokenCards = wrapper.findAll('.token-card')
    expect(tokenCards).toHaveLength(1)
  })

  it('opens create dialog when "Create Token" clicked', async () => {
    const wrapper = mount(ApiKeyManager, {
      props: {
        organization: mockOrganization,
        existingTokens: [],
        availableAbilities: [],
        license: mockLicense,
        rateLimits: mockRateLimits,
      },
    })

    const createBtn = wrapper.find('button.btn-primary')
    await createBtn.trigger('click')

    expect(wrapper.vm.showCreateDialog).toBe(true)
  })

  it('displays empty state when no tokens exist', () => {
    const wrapper = mount(ApiKeyManager, {
      props: {
        organization: mockOrganization,
        existingTokens: [],
        availableAbilities: [],
        license: mockLicense,
        rateLimits: mockRateLimits,
      },
    })

    expect(wrapper.text()).toContain('No tokens found')
    expect(wrapper.text()).toContain('Create your first API token')
  })

  it('emits view-usage event when usage button clicked', async () => {
    const wrapper = mount(ApiKeyManager, {
      props: {
        organization: mockOrganization,
        existingTokens: mockTokens,
        availableAbilities: [],
        license: mockLicense,
        rateLimits: mockRateLimits,
      },
    })

    const usageBtn = wrapper.find('.btn-icon[title="View Usage"]')
    await usageBtn.trigger('click')

    expect(wrapper.emitted('view-usage')).toBeTruthy()
    expect(wrapper.emitted('view-usage')[0][0]).toEqual(mockTokens[0])
  })
})
```

### Integration Tests (Pest)

**File:** `tests/Feature/Enterprise/ApiTokenManagementTest.php`

```php
<?php

use App\Models\Organization;
use App\Models\User;
use Illuminate\Support\Facades\Hash;

it('displays API token management page', function () {
    $organization = Organization::factory()->create();
    $user = User::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    $this->actingAs($user)
        ->get(route('enterprise.api.tokens.index', $organization))
        ->assertSuccessful()
        ->assertInertia(fn ($page) => $page
            ->component('Enterprise/Api/TokenManagement')
            ->has('organization')
            ->has('availableAbilities')
            ->has('license')
            ->has('rateLimits')
        );
});

it('creates API token successfully', function () {
    $organization = Organization::factory()->create();
    $user = User::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    $response = $this->actingAs($user)
        ->postJson(route('enterprise.api.tokens.store', $organization), [
            'name' => 'Test Token',
            'abilities' => ['server:read', 'application:deploy'],
        ]);

    $response->assertSuccessful()
        ->assertJsonStructure(['token', 'plainTextToken', 'name', 'abilities']);

    $this->assertDatabaseHas('personal_access_tokens', [
        'tokenable_id' => $organization->id,
        'name' => 'Test Token',
    ]);
});

it('enforces token limit for pro tier', function () {
    $organization = Organization::factory()->create();
    $license = EnterpriseLicense::factory()->create([
        'organization_id' => $organization->id,
        'tier' => 'pro',
    ]);

    $user = User::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    // Create 25 tokens (pro limit)
    for ($i = 0; $i < 25; $i++) {
        $organization->createToken("Token {$i}", ['*']);
    }

    // Attempt to create 26th token
    $response = $this->actingAs($user)
        ->postJson(route('enterprise.api.tokens.store', $organization), [
            'name' => 'Exceeds Limit',
            'abilities' => ['*'],
        ]);

    $response->assertStatus(302)
        ->assertSessionHasErrors('token');
});

it('revokes token successfully', function () {
    $organization = Organization::factory()->create();
    $user = User::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    $token = $organization->createToken('Test Token', ['*']);

    $this->actingAs($user)
        ->deleteJson(route('enterprise.api.tokens.destroy', [
            'organization' => $organization,
            'token' => $token->accessToken->id,
        ]))
        ->assertSuccessful();

    $this->assertDatabaseMissing('personal_access_tokens', [
        'id' => $token->accessToken->id,
    ]);
});

it('validates token expiration date', function () {
    $organization = Organization::factory()->create();
    $user = User::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    $response = $this->actingAs($user)
        ->postJson(route('enterprise.api.tokens.store', $organization), [
            'name' => 'Test Token',
            'abilities' => ['*'],
            'expires_at' => '2020-01-01', // Past date
        ]);

    $response->assertSessionHasErrors('expires_at');
});
```

### Browser Tests (Dusk)

**File:** `tests/Browser/Enterprise/ApiTokenManagementTest.php`

```php
<?php

use Laravel\Dusk\Browser;

it('creates API token via UI', function () {
    $this->browse(function (Browser $browser) {
        $organization = Organization::factory()->create();
        $user = User::factory()->create();
        $organization->users()->attach($user, ['role' => 'admin']);

        $browser->loginAs($user)
            ->visit(route('enterprise.api.tokens.index', $organization))
            ->click('@create-token-btn')
            ->waitFor('@token-creation-dialog')
            ->type('name', 'CI/CD Pipeline')
            ->click('@template-deploy-only')
            ->click('@create-token-submit')
            ->waitFor('@token-display-dialog')
            ->assertSee('Save this token now!')
            ->assertPresent('@token-plaintext')
            ->click('@copy-token-btn')
            ->assertSee('Copied!')
            ->click('@token-display-close')
            ->waitForText('CI/CD Pipeline')
            ->assertSee('application:deploy');
    });
});

it('revokes token with confirmation', function () {
    $this->browse(function (Browser $browser) {
        $organization = Organization::factory()->create();
        $user = User::factory()->create();
        $organization->users()->attach($user, ['role' => 'admin']);

        $token = $organization->createToken('Test Token', ['*']);

        $browser->loginAs($user)
            ->visit(route('enterprise.api.tokens.index', $organization))
            ->click('@revoke-token-' . $token->accessToken->id)
            ->waitFor('@revoke-confirmation-dialog')
            ->assertSee('Test Token')
            ->click('@confirm-revoke-btn')
            ->waitUntilMissing('@revoke-confirmation-dialog')
            ->assertDontSee('Test Token');
    });
});
```

## Definition of Done

- [ ] ApiKeyManager.vue component created with full functionality
- [ ] TokenCreationDialog.vue component created with form validation
- [ ] TokenAbilitySelector.vue component created with grouped checkboxes
- [ ] TokenDisplayDialog.vue component created with one-time display
- [ ] TokenRevokeConfirmation.vue component created
- [ ] useApiTokens.js composable implemented with API integration
- [ ] useClipboard.js composable implemented with secure copy
- [ ] Token list displays all tokens with correct information
- [ ] Search and filter functionality working correctly
- [ ] Token creation flow working with ability selection
- [ ] Token display shows plaintext token only once
- [ ] Clipboard copy working with visual feedback
- [ ] Token revocation working with confirmation dialog
- [ ] License-based token limits enforced
- [ ] Rate limit tier display implemented
- [ ] Template selection working (Read-Only, Read-Write, Deploy-Only, Full Access)
- [ ] Expiration date validation implemented
- [ ] Responsive design working on all screen sizes
- [ ] Dark mode support implemented
- [ ] Accessibility features implemented (ARIA labels, keyboard navigation)
- [ ] Loading states for all async operations
- [ ] Error handling for API failures
- [ ] Unit tests written and passing (15+ tests, >90% coverage)
- [ ] Integration tests written and passing (8+ tests)
- [ ] Browser tests written and passing (2+ tests)
- [ ] Code follows Vue.js 3 Composition API best practices
- [ ] Component props and events documented
- [ ] Manual testing completed with various license tiers
- [ ] Code reviewed and approved

## Related Tasks

- **Depends on:** Task 52 (Extend Laravel Sanctum tokens with organization context)
- **Integrates with:** Task 53 (ApiOrganizationScope middleware)
- **Integrates with:** Task 54 (Tiered rate limiting middleware)
- **Integrates with:** Task 60 (ApiUsageMonitoring.vue for usage visualization)
- **Used by:** Organization administrators for API access management
- **Referenced by:** Developer documentation for API authentication
