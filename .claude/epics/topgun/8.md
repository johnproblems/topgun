---
name: Create BrandingPreview.vue component for real-time branding changes visualization
status: open
created: 2025-10-06T15:23:47Z
updated: 2025-10-06T20:38:27Z
github: https://github.com/johnproblems/topgun/issues/118
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Create BrandingPreview.vue component for real-time branding changes visualization

## Description

Create a sophisticated Vue.js 3 component that provides real-time visualization of branding changes within the white-label system. This component serves as a live preview panel, allowing organization administrators to see exactly how their customizations (colors, fonts, logos, domain names) will appear across various UI elements before committing changes. The preview eliminates the guesswork from branding customization by showing an accurate representation of the final product in real-time.

The BrandingPreview component addresses a critical UX challenge in white-label systems: administrators need confidence that their branding choices work harmoniously across all UI contexts. Without a preview, they would need to save changes, navigate through the application, and verify the appearance manually—a tedious, time-consuming process prone to iteration fatigue. The preview component provides instant feedback, enabling rapid experimentation and confident decision-making.

**Key Capabilities:**

1. **Real-Time Updates**: Reflects changes from BrandingManager and ThemeCustomizer instantly without page refresh
2. **Multi-Context Preview**: Shows branding across different UI contexts (light mode, dark mode, various component states)
3. **Component Gallery**: Displays sample UI elements (buttons, cards, forms, navigation, alerts) with applied branding
4. **Responsive Preview**: Demonstrates how branding appears on desktop, tablet, and mobile viewports
5. **Interactive Elements**: Allows interaction with preview components to see hover, active, and focus states
6. **Before/After Comparison**: Optionally displays original branding alongside customized version
7. **Accessibility Indicators**: Highlights potential accessibility issues with chosen color combinations

**Integration Architecture:**

The BrandingPreview component integrates seamlessly with the broader white-label ecosystem:

- **Parent Component**: Used within BrandingManager.vue (Task 5) as the right-panel preview
- **Data Flow**: Receives branding configuration via props from parent, updates reactively as user modifies settings
- **CSS Application**: Dynamically applies CSS custom properties to preview iframe or scoped container
- **Color System**: Works with ThemeCustomizer.vue (Task 6) to preview color palette changes
- **Logo Display**: Shows uploaded logos from LogoUploader.vue (Task 4) in realistic contexts
- **Asset Loading**: Fetches compiled CSS from DynamicAssetController (Task 2) or applies inline styles
- **Performance**: Debounced updates prevent excessive re-renders during rapid color adjustments

**Why This Task is Critical:**

Professional branding requires visual confidence. The BrandingPreview component transforms the white-label customization experience from trial-and-error guesswork into precision design work. It reduces the feedback loop from minutes (save → navigate → check → repeat) to milliseconds (adjust → see → decide). This acceleration enables better branding outcomes, reduces administrator frustration, and ensures the white-labeled platform reflects the organization's brand accurately from the first publish.

The preview also serves as a quality gate, preventing common branding mistakes like insufficient contrast, illegible text on backgrounds, or logos that don't work with chosen color schemes. By surfacing these issues during configuration rather than after deployment, it saves time and maintains professional standards.

## Acceptance Criteria

- [ ] BrandingPreview.vue component created with Composition API structure
- [ ] Real-time updates when parent component passes new branding configuration
- [ ] Display sample UI components: buttons (primary, secondary, danger), links, cards, forms, navigation bar, alerts
- [ ] Show branding in multiple states: default, hover, active, disabled, loading
- [ ] Support light mode and dark mode preview toggle
- [ ] Responsive viewport selector (desktop 1920px, tablet 768px, mobile 375px)
- [ ] Apply CSS custom properties dynamically based on received configuration
- [ ] Display uploaded logos in realistic contexts (header, favicon preview, footer)
- [ ] Show platform name in navigation and page titles
- [ ] Include before/after comparison mode (original vs. customized)
- [ ] Highlight accessibility warnings for contrast ratio failures
- [ ] Debounced updates (150ms delay) to prevent excessive re-renders
- [ ] Loading state indicator while preview regenerates
- [ ] Fullscreen preview mode for detailed inspection
- [ ] Export preview as PNG screenshot feature

## Technical Details

### Component Location
- **File:** `resources/js/Components/Enterprise/WhiteLabel/BrandingPreview.vue`

### Component Architecture

```vue
<script setup>
import { ref, computed, watch, nextTick } from 'vue'
import { useDebounceFn } from '@vueuse/core'
import html2canvas from 'html2canvas'

const props = defineProps({
  config: {
    type: Object,
    required: true,
    default: () => ({
      primary_color: '#3b82f6',
      secondary_color: '#10b981',
      accent_color: '#f59e0b',
      text_color: '#1f2937',
      background_color: '#ffffff',
      heading_font: 'Inter',
      body_font: 'Inter',
      font_size_base: '16px',
      platform_name: 'Platform',
      primary_logo_url: null,
      favicon_url: null,
    })
  },
  organization: {
    type: Object,
    required: true,
  },
  showComparison: {
    type: Boolean,
    default: false,
  },
})

const emit = defineEmits(['screenshot-captured', 'fullscreen-toggled'])

// State
const previewMode = ref('desktop') // desktop, tablet, mobile
const colorMode = ref('light') // light, dark
const isFullscreen = ref(false)
const isUpdating = ref(false)
const showAccessibilityWarnings = ref(true)

// Computed CSS variables
const cssVariables = computed(() => {
  const config = props.config

  return {
    '--color-primary': config.primary_color,
    '--color-secondary': config.secondary_color,
    '--color-accent': config.accent_color,
    '--color-text': config.text_color,
    '--color-background': config.background_color,

    // Derived colors for UI states
    '--color-primary-hover': adjustColor(config.primary_color, -10),
    '--color-primary-active': adjustColor(config.primary_color, -20),
    '--color-secondary-hover': adjustColor(config.secondary_color, -10),
    '--color-border': adjustColor(config.text_color, 80),

    // Typography
    '--font-heading': config.heading_font,
    '--font-body': config.body_font,
    '--font-size-base': config.font_size_base,
    '--font-size-sm': calculateRelativeSize(config.font_size_base, 0.875),
    '--font-size-lg': calculateRelativeSize(config.font_size_base, 1.125),
    '--font-size-xl': calculateRelativeSize(config.font_size_base, 1.25),
    '--font-size-2xl': calculateRelativeSize(config.font_size_base, 1.5),

    // Spacing (derived from base font size)
    '--spacing-1': calculateRelativeSize(config.font_size_base, 0.25),
    '--spacing-2': calculateRelativeSize(config.font_size_base, 0.5),
    '--spacing-3': calculateRelativeSize(config.font_size_base, 0.75),
    '--spacing-4': calculateRelativeSize(config.font_size_base, 1),
  }
})

// Viewport dimensions
const viewportDimensions = computed(() => {
  const dimensions = {
    desktop: { width: '100%', height: 'auto' },
    tablet: { width: '768px', height: '1024px' },
    mobile: { width: '375px', height: '667px' },
  }

  return dimensions[previewMode.value]
})

// Accessibility checks
const accessibilityIssues = computed(() => {
  const issues = []
  const config = props.config

  // Check contrast ratios
  const textOnBg = getContrastRatio(config.text_color, config.background_color)
  const primaryOnBg = getContrastRatio(config.primary_color, config.background_color)

  if (textOnBg < 4.5) {
    issues.push({
      type: 'contrast',
      severity: 'high',
      message: `Text color has insufficient contrast (${textOnBg.toFixed(2)}:1). Minimum: 4.5:1`,
    })
  }

  if (primaryOnBg < 3) {
    issues.push({
      type: 'contrast',
      severity: 'medium',
      message: `Primary color has low contrast for UI elements (${primaryOnBg.toFixed(2)}:1). Recommended: 3:1+`,
    })
  }

  return issues
})

// Methods
const adjustColor = (hex, percent) => {
  // Simple color adjustment (lighten/darken)
  const num = parseInt(hex.replace('#', ''), 16)
  const amt = Math.round(2.55 * percent)
  const R = (num >> 16) + amt
  const G = (num >> 8 & 0x00FF) + amt
  const B = (num & 0x0000FF) + amt

  return '#' + (
    0x1000000 +
    (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
    (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
    (B < 255 ? (B < 1 ? 0 : B) : 255)
  ).toString(16).slice(1)
}

const calculateRelativeSize = (baseSize, multiplier) => {
  const base = parseFloat(baseSize)
  return `${base * multiplier}px`
}

const getContrastRatio = (color1, color2) => {
  // Simplified contrast calculation
  const getLuminance = (hex) => {
    const rgb = parseInt(hex.replace('#', ''), 16)
    const r = (rgb >> 16) / 255
    const g = ((rgb >> 8) & 0xff) / 255
    const b = (rgb & 0xff) / 255

    const [rs, gs, bs] = [r, g, b].map(c =>
      c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4)
    )

    return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs
  }

  const lum1 = getLuminance(color1)
  const lum2 = getLuminance(color2)
  const lighter = Math.max(lum1, lum2)
  const darker = Math.min(lum1, lum2)

  return (lighter + 0.05) / (darker + 0.05)
}

const toggleFullscreen = () => {
  isFullscreen.value = !isFullscreen.value
  emit('fullscreen-toggled', isFullscreen.value)
}

const captureScreenshot = async () => {
  const previewElement = document.querySelector('.preview-content')
  if (!previewElement) return

  try {
    const canvas = await html2canvas(previewElement, {
      backgroundColor: props.config.background_color,
      scale: 2, // High DPI
    })

    canvas.toBlob((blob) => {
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a')
      a.href = url
      a.download = `${props.organization.name.toLowerCase().replace(/\s+/g, '-')}-branding-preview.png`
      a.click()

      emit('screenshot-captured', url)
    })
  } catch (error) {
    console.error('Screenshot capture failed:', error)
  }
}

const switchViewport = (mode) => {
  previewMode.value = mode
}

const toggleColorMode = () => {
  colorMode.value = colorMode.value === 'light' ? 'dark' : 'light'
}

// Debounced update handler
const debouncedUpdate = useDebounceFn(() => {
  isUpdating.value = true

  nextTick(() => {
    // Simulate CSS recalculation delay
    setTimeout(() => {
      isUpdating.value = false
    }, 100)
  })
}, 150)

// Watch for config changes
watch(
  () => props.config,
  () => {
    debouncedUpdate()
  },
  { deep: true }
)
</script>

<template>
  <div
    class="branding-preview"
    :class="{ 'fullscreen': isFullscreen }"
  >
    <!-- Preview Toolbar -->
    <div class="preview-toolbar">
      <div class="toolbar-section">
        <h4 class="toolbar-title">Live Preview</h4>

        <div class="viewport-switcher">
          <button
            v-for="mode in ['desktop', 'tablet', 'mobile']"
            :key="mode"
            class="viewport-btn"
            :class="{ active: previewMode === mode }"
            @click="switchViewport(mode)"
            :title="`${mode.charAt(0).toUpperCase() + mode.slice(1)} view`"
          >
            <Icon :name="`device-${mode}`" class="w-4 h-4" />
          </button>
        </div>
      </div>

      <div class="toolbar-actions">
        <button
          class="toolbar-btn"
          @click="toggleColorMode"
          :title="`Switch to ${colorMode === 'light' ? 'dark' : 'light'} mode`"
        >
          <Icon :name="colorMode === 'light' ? 'moon' : 'sun'" class="w-4 h-4" />
        </button>

        <button
          class="toolbar-btn"
          @click="captureScreenshot"
          title="Download screenshot"
        >
          <Icon name="camera" class="w-4 h-4" />
        </button>

        <button
          class="toolbar-btn"
          @click="toggleFullscreen"
          :title="isFullscreen ? 'Exit fullscreen' : 'Enter fullscreen'"
        >
          <Icon :name="isFullscreen ? 'minimize' : 'maximize'" class="w-4 h-4" />
        </button>
      </div>
    </div>

    <!-- Accessibility Warnings -->
    <div v-if="showAccessibilityWarnings && accessibilityIssues.length > 0" class="accessibility-warnings">
      <div
        v-for="(issue, index) in accessibilityIssues"
        :key="index"
        class="warning-item"
        :class="`severity-${issue.severity}`"
      >
        <Icon name="alert-triangle" class="w-4 h-4" />
        <span>{{ issue.message }}</span>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div v-if="isUpdating" class="updating-overlay">
      <div class="spinner"></div>
      <span>Updating preview...</span>
    </div>

    <!-- Preview Content -->
    <div
      class="preview-container"
      :style="{
        width: viewportDimensions.width,
        height: viewportDimensions.height
      }"
    >
      <div
        class="preview-content"
        :style="cssVariables"
        :class="`mode-${colorMode}`"
      >
        <!-- Header/Navigation -->
        <div class="preview-header">
          <div class="header-logo">
            <img
              v-if="config.primary_logo_url"
              :src="config.primary_logo_url"
              :alt="`${config.platform_name} logo`"
              class="logo-img"
            />
            <span v-else class="logo-text">{{ config.platform_name }}</span>
          </div>

          <nav class="header-nav">
            <a href="#" class="nav-link">Dashboard</a>
            <a href="#" class="nav-link">Projects</a>
            <a href="#" class="nav-link">Settings</a>
          </nav>

          <div class="header-actions">
            <button class="btn btn-secondary btn-sm">Help</button>
            <button class="btn btn-primary btn-sm">Account</button>
          </div>
        </div>

        <!-- Main Content Area -->
        <div class="preview-main">
          <div class="content-section">
            <h1 class="heading-xl">Welcome to {{ config.platform_name }}</h1>
            <p class="text-body">
              This is a live preview of your white-label branding.
              All changes are reflected in real-time.
            </p>

            <!-- Button Gallery -->
            <div class="component-gallery">
              <h3 class="heading-md">Buttons</h3>
              <div class="button-row">
                <button class="btn btn-primary">Primary Button</button>
                <button class="btn btn-secondary">Secondary Button</button>
                <button class="btn btn-danger">Danger Button</button>
                <button class="btn btn-primary" disabled>Disabled</button>
              </div>
            </div>

            <!-- Card Component -->
            <div class="component-gallery">
              <h3 class="heading-md">Cards</h3>
              <div class="card-grid">
                <div class="card">
                  <div class="card-header">
                    <h4 class="card-title">Feature Card</h4>
                  </div>
                  <div class="card-body">
                    <p>This card demonstrates how your branding appears on content containers.</p>
                    <a href="#" class="card-link">Learn more →</a>
                  </div>
                </div>

                <div class="card card-accent">
                  <div class="card-header">
                    <h4 class="card-title">Highlighted Card</h4>
                  </div>
                  <div class="card-body">
                    <p>Cards can use accent colors for emphasis and visual hierarchy.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Form Elements -->
            <div class="component-gallery">
              <h3 class="heading-md">Forms</h3>
              <div class="form-demo">
                <div class="form-group">
                  <label class="form-label">Email Address</label>
                  <input
                    type="email"
                    class="form-input"
                    placeholder="you@example.com"
                  />
                </div>

                <div class="form-group">
                  <label class="form-label">Message</label>
                  <textarea
                    class="form-textarea"
                    rows="3"
                    placeholder="Type your message here..."
                  ></textarea>
                </div>

                <div class="form-group">
                  <label class="form-checkbox">
                    <input type="checkbox" />
                    <span>I agree to the terms and conditions</span>
                  </label>
                </div>

                <button class="btn btn-primary">Submit Form</button>
              </div>
            </div>

            <!-- Alert Components -->
            <div class="component-gallery">
              <h3 class="heading-md">Alerts</h3>
              <div class="alert-stack">
                <div class="alert alert-success">
                  <Icon name="check-circle" class="w-5 h-5" />
                  <span>Success! Your changes have been saved.</span>
                </div>

                <div class="alert alert-warning">
                  <Icon name="alert-triangle" class="w-5 h-5" />
                  <span>Warning: Please review your settings.</span>
                </div>

                <div class="alert alert-danger">
                  <Icon name="x-circle" class="w-5 h-5" />
                  <span>Error: Something went wrong.</span>
                </div>
              </div>
            </div>

            <!-- Links -->
            <div class="component-gallery">
              <h3 class="heading-md">Links & Typography</h3>
              <p class="text-body">
                This is body text with a <a href="#" class="text-link">text link</a> embedded.
                Links use your primary color for consistency.
              </p>
              <p class="text-sm text-muted">
                This is smaller, muted text often used for descriptions or metadata.
              </p>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="preview-footer">
          <div class="footer-content">
            <div class="footer-logo">
              <img
                v-if="config.primary_logo_url"
                :src="config.primary_logo_url"
                :alt="`${config.platform_name} logo`"
                class="footer-logo-img"
              />
              <span v-else>{{ config.platform_name }}</span>
            </div>
            <div class="footer-links">
              <a href="#" class="footer-link">About</a>
              <a href="#" class="footer-link">Privacy</a>
              <a href="#" class="footer-link">Terms</a>
              <a href="#" class="footer-link">Contact</a>
            </div>
            <div class="footer-copy">
              © {{ new Date().getFullYear() }} {{ config.platform_name }}. All rights reserved.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Favicon Preview -->
    <div v-if="config.favicon_url" class="favicon-preview">
      <span class="text-sm text-muted">Favicon:</span>
      <img
        :src="config.favicon_url"
        alt="Favicon preview"
        class="favicon-img"
      />
    </div>
  </div>
</template>

<style scoped>
.branding-preview {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: #f9fafb;
  border-radius: 0.5rem;
  overflow: hidden;
}

.branding-preview.fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 9999;
  border-radius: 0;
}

.preview-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem;
  background: white;
  border-bottom: 1px solid #e5e7eb;
}

.toolbar-section {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.toolbar-title {
  font-size: 0.875rem;
  font-weight: 600;
  color: #374151;
  margin: 0;
}

.viewport-switcher {
  display: flex;
  gap: 0.25rem;
  background: #f3f4f6;
  padding: 0.25rem;
  border-radius: 0.375rem;
}

.viewport-btn {
  padding: 0.5rem;
  border: none;
  background: transparent;
  border-radius: 0.25rem;
  cursor: pointer;
  color: #6b7280;
  transition: all 0.2s;
}

.viewport-btn.active {
  background: white;
  color: #3b82f6;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.toolbar-actions {
  display: flex;
  gap: 0.5rem;
}

.toolbar-btn {
  padding: 0.5rem;
  border: 1px solid #e5e7eb;
  background: white;
  border-radius: 0.375rem;
  cursor: pointer;
  color: #6b7280;
  transition: all 0.2s;
}

.toolbar-btn:hover {
  background: #f9fafb;
  color: #374151;
}

.accessibility-warnings {
  background: #fef3c7;
  border-bottom: 1px solid #f59e0b;
  padding: 0.75rem 1rem;
}

.warning-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: #92400e;
  font-size: 0.875rem;
}

.warning-item.severity-high {
  color: #991b1b;
}

.updating-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  z-index: 100;
}

.spinner {
  width: 1.5rem;
  height: 1.5rem;
  border: 2px solid #e5e7eb;
  border-top-color: #3b82f6;
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.preview-container {
  flex: 1;
  overflow: auto;
  margin: 1rem auto;
  background: white;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  border-radius: 0.5rem;
}

.preview-content {
  min-height: 100%;
  background: var(--color-background);
  color: var(--color-text);
  font-family: var(--font-body);
  font-size: var(--font-size-base);
}

.preview-content.mode-dark {
  --color-background: #1f2937;
  --color-text: #f9fafb;
}

/* Preview Components Styling */
.preview-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 2rem;
  background: var(--color-background);
  border-bottom: 1px solid var(--color-border);
}

.header-logo {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.logo-img {
  height: 2.5rem;
  width: auto;
}

.logo-text {
  font-size: var(--font-size-xl);
  font-weight: 700;
  font-family: var(--font-heading);
  color: var(--color-primary);
}

.header-nav {
  display: flex;
  gap: 1.5rem;
}

.nav-link {
  color: var(--color-text);
  text-decoration: none;
  font-weight: 500;
  transition: color 0.2s;
}

.nav-link:hover {
  color: var(--color-primary);
}

.header-actions {
  display: flex;
  gap: 0.5rem;
}

.preview-main {
  padding: 2rem;
}

.content-section {
  max-width: 900px;
  margin: 0 auto;
}

.heading-xl {
  font-size: var(--font-size-2xl);
  font-family: var(--font-heading);
  font-weight: 700;
  color: var(--color-text);
  margin: 0 0 1rem;
}

.heading-md {
  font-size: var(--font-size-lg);
  font-family: var(--font-heading);
  font-weight: 600;
  color: var(--color-text);
  margin: 0 0 0.75rem;
}

.text-body {
  color: var(--color-text);
  line-height: 1.6;
  margin-bottom: 1rem;
}

.text-sm {
  font-size: var(--font-size-sm);
}

.text-muted {
  color: var(--color-border);
}

.text-link {
  color: var(--color-primary);
  text-decoration: none;
}

.text-link:hover {
  color: var(--color-primary-hover);
  text-decoration: underline;
}

.component-gallery {
  margin: 2rem 0;
  padding: 1.5rem;
  background: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: 0.5rem;
}

.button-row {
  display: flex;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.btn {
  padding: 0.5rem 1rem;
  border-radius: 0.375rem;
  font-weight: 500;
  font-size: var(--font-size-base);
  border: none;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-sm {
  padding: 0.375rem 0.75rem;
  font-size: var(--font-size-sm);
}

.btn-primary {
  background: var(--color-primary);
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background: var(--color-primary-hover);
}

.btn-secondary {
  background: var(--color-secondary);
  color: white;
}

.btn-secondary:hover:not(:disabled) {
  background: var(--color-secondary-hover);
}

.btn-danger {
  background: #ef4444;
  color: white;
}

.btn-danger:hover:not(:disabled) {
  background: #dc2626;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.card-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.card {
  background: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: 0.5rem;
  overflow: hidden;
}

.card-accent {
  border-color: var(--color-accent);
  border-width: 2px;
}

.card-header {
  padding: 1rem;
  border-bottom: 1px solid var(--color-border);
}

.card-title {
  margin: 0;
  font-size: var(--font-size-base);
  font-weight: 600;
  color: var(--color-text);
}

.card-body {
  padding: 1rem;
}

.card-link {
  color: var(--color-primary);
  text-decoration: none;
  font-weight: 500;
}

.form-demo {
  max-width: 400px;
}

.form-group {
  margin-bottom: 1rem;
}

.form-label {
  display: block;
  margin-bottom: 0.375rem;
  font-weight: 500;
  color: var(--color-text);
  font-size: var(--font-size-sm);
}

.form-input,
.form-textarea {
  width: 100%;
  padding: 0.5rem 0.75rem;
  border: 1px solid var(--color-border);
  border-radius: 0.375rem;
  background: var(--color-background);
  color: var(--color-text);
  font-size: var(--font-size-base);
  font-family: var(--font-body);
}

.form-input:focus,
.form-textarea:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-checkbox {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
}

.alert-stack {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.alert {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  border-radius: 0.375rem;
  font-size: var(--font-size-sm);
}

.alert-success {
  background: #d1fae5;
  color: #065f46;
  border: 1px solid #10b981;
}

.alert-warning {
  background: #fef3c7;
  color: #92400e;
  border: 1px solid #f59e0b;
}

.alert-danger {
  background: #fee2e2;
  color: #991b1b;
  border: 1px solid #ef4444;
}

.preview-footer {
  margin-top: auto;
  padding: 2rem;
  background: var(--color-background);
  border-top: 1px solid var(--color-border);
}

.footer-content {
  max-width: 900px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
  text-align: center;
}

.footer-logo-img {
  height: 2rem;
  width: auto;
}

.footer-links {
  display: flex;
  gap: 1.5rem;
  flex-wrap: wrap;
}

.footer-link {
  color: var(--color-text);
  text-decoration: none;
  font-size: var(--font-size-sm);
}

.footer-link:hover {
  color: var(--color-primary);
}

.footer-copy {
  font-size: var(--font-size-sm);
  color: var(--color-border);
}

.favicon-preview {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1rem;
  background: white;
  border-top: 1px solid #e5e7eb;
}

.favicon-img {
  width: 1.5rem;
  height: 1.5rem;
  border: 1px solid #e5e7eb;
  border-radius: 0.25rem;
}

@media (max-width: 768px) {
  .preview-header {
    flex-direction: column;
    gap: 1rem;
    align-items: flex-start;
  }

  .header-nav {
    flex-direction: column;
    gap: 0.5rem;
  }

  .viewport-switcher {
    display: none;
  }
}
</style>
```

### Integration with Parent Component

**Usage in BrandingManager.vue:**

```vue
<template>
  <div class="branding-manager-layout">
    <div class="settings-panel">
      <!-- Branding configuration forms -->
    </div>

    <div class="preview-panel">
      <BrandingPreview
        :config="form.data()"
        :organization="organization"
        :show-comparison="showComparison"
        @screenshot-captured="handleScreenshot"
        @fullscreen-toggled="handleFullscreenToggle"
      />
    </div>
  </div>
</template>

<script setup>
import BrandingPreview from './BrandingPreview.vue'

const handleScreenshot = (imageUrl) => {
  // Handle screenshot (e.g., save to backend, show success message)
  console.log('Screenshot captured:', imageUrl)
}

const handleFullscreenToggle = (isFullscreen) => {
  // Adjust layout when preview goes fullscreen
  console.log('Fullscreen toggled:', isFullscreen)
}
</script>
```

### Dependencies

Install html2canvas for screenshot functionality:

```bash
npm install html2canvas
```

## Implementation Approach

### Step 1: Create Component Structure
1. Create `BrandingPreview.vue` in `resources/js/Components/Enterprise/WhiteLabel/`
2. Set up Vue 3 Composition API with props and emits
3. Define reactive state for preview mode, color mode, fullscreen

### Step 2: Build CSS Variable System
1. Create computed property `cssVariables` that generates CSS custom properties from config
2. Implement color adjustment functions for hover/active states
3. Add relative size calculations for typography and spacing
4. Apply variables to scoped preview container

### Step 3: Create Preview Toolbar
1. Build viewport switcher (desktop, tablet, mobile)
2. Add color mode toggle (light/dark)
3. Implement screenshot capture button
4. Add fullscreen toggle button

### Step 4: Build Component Gallery
1. Create header with logo and navigation
2. Add button gallery showing all button variants
3. Build card components with standard and accent styles
4. Create form elements (inputs, textareas, checkboxes)
5. Add alert components (success, warning, danger)
6. Include typography samples with links

### Step 5: Implement Real-Time Updates
1. Watch props.config for changes (deep watch)
2. Use useDebounceFn to debounce updates (150ms)
3. Show loading overlay during updates
4. Apply new CSS variables reactively

### Step 6: Add Accessibility Checks
1. Implement contrast ratio calculator (WCAG 2.1 standards)
2. Create computed property for accessibility issues
3. Display warnings for insufficient contrast
4. Show visual indicators for issues

### Step 7: Implement Screenshot Feature
1. Install and import html2canvas library
2. Capture preview content as canvas
3. Convert canvas to blob and trigger download
4. Emit screenshot-captured event with image URL

### Step 8: Add Responsive Behavior
1. Create viewport dimension calculator
2. Apply dimensions to preview container
3. Handle mobile viewport responsiveness
4. Ensure preview works on all screen sizes

### Step 9: Polish and UX Enhancements
1. Add smooth transitions for all state changes
2. Implement loading states
3. Add fullscreen mode
4. Ensure keyboard accessibility

### Step 10: Testing and Integration
1. Test with various branding configurations
2. Verify real-time updates work correctly
3. Test screenshot capture on different browsers
4. Ensure accessibility warnings are accurate

## Test Strategy

### Unit Tests (Vitest/Vue Test Utils)

**File:** `resources/js/Components/Enterprise/WhiteLabel/__tests__/BrandingPreview.spec.js`

```javascript
import { mount } from '@vue/test-utils'
import { describe, it, expect, vi } from 'vitest'
import BrandingPreview from '../BrandingPreview.vue'

describe('BrandingPreview.vue', () => {
  const defaultConfig = {
    primary_color: '#3b82f6',
    secondary_color: '#10b981',
    accent_color: '#f59e0b',
    text_color: '#1f2937',
    background_color: '#ffffff',
    heading_font: 'Inter',
    body_font: 'Inter',
    font_size_base: '16px',
    platform_name: 'Test Platform',
  }

  const defaultOrganization = {
    id: 1,
    name: 'Test Org',
  }

  it('renders preview content with default configuration', () => {
    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    expect(wrapper.find('.branding-preview').exists()).toBe(true)
    expect(wrapper.text()).toContain('Test Platform')
  })

  it('generates correct CSS variables from configuration', () => {
    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    const cssVars = wrapper.vm.cssVariables

    expect(cssVars['--color-primary']).toBe('#3b82f6')
    expect(cssVars['--color-secondary']).toBe('#10b981')
    expect(cssVars['--font-heading']).toBe('Inter')
    expect(cssVars['--font-size-base']).toBe('16px')
  })

  it('switches viewport modes correctly', async () => {
    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    expect(wrapper.vm.previewMode).toBe('desktop')

    await wrapper.vm.switchViewport('tablet')
    expect(wrapper.vm.previewMode).toBe('tablet')

    await wrapper.vm.switchViewport('mobile')
    expect(wrapper.vm.previewMode).toBe('mobile')
  })

  it('toggles color mode between light and dark', async () => {
    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    expect(wrapper.vm.colorMode).toBe('light')

    await wrapper.vm.toggleColorMode()
    expect(wrapper.vm.colorMode).toBe('dark')

    await wrapper.vm.toggleColorMode()
    expect(wrapper.vm.colorMode).toBe('light')
  })

  it('calculates contrast ratios correctly', () => {
    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    const ratio = wrapper.vm.getContrastRatio('#000000', '#ffffff')
    expect(ratio).toBeCloseTo(21, 0) // Perfect contrast
  })

  it('detects accessibility issues with low contrast', () => {
    const lowContrastConfig = {
      ...defaultConfig,
      text_color: '#dddddd', // Light gray on white background
      background_color: '#ffffff',
    }

    const wrapper = mount(BrandingPreview, {
      props: {
        config: lowContrastConfig,
        organization: defaultOrganization,
      }
    })

    expect(wrapper.vm.accessibilityIssues.length).toBeGreaterThan(0)
    expect(wrapper.vm.accessibilityIssues[0].type).toBe('contrast')
  })

  it('emits fullscreen-toggled event', async () => {
    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    await wrapper.vm.toggleFullscreen()

    expect(wrapper.emitted('fullscreen-toggled')).toBeTruthy()
    expect(wrapper.emitted('fullscreen-toggled')[0][0]).toBe(true)
  })

  it('updates preview when config changes', async () => {
    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    await wrapper.setProps({
      config: {
        ...defaultConfig,
        primary_color: '#ff0000',
      }
    })

    await wrapper.vm.$nextTick()

    expect(wrapper.vm.cssVariables['--color-primary']).toBe('#ff0000')
  })

  it('displays uploaded logo in header', () => {
    const configWithLogo = {
      ...defaultConfig,
      primary_logo_url: 'https://example.com/logo.png',
    }

    const wrapper = mount(BrandingPreview, {
      props: {
        config: configWithLogo,
        organization: defaultOrganization,
      }
    })

    const logoImg = wrapper.find('.logo-img')
    expect(logoImg.exists()).toBe(true)
    expect(logoImg.attributes('src')).toBe('https://example.com/logo.png')
  })

  it('shows platform name when no logo provided', () => {
    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    expect(wrapper.find('.logo-text').text()).toBe('Test Platform')
  })

  it('debounces updates correctly', async () => {
    vi.useFakeTimers()

    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    // Trigger multiple rapid updates
    await wrapper.setProps({ config: { ...defaultConfig, primary_color: '#ff0000' } })
    await wrapper.setProps({ config: { ...defaultConfig, primary_color: '#00ff00' } })
    await wrapper.setProps({ config: { ...defaultConfig, primary_color: '#0000ff' } })

    // Should show updating overlay
    expect(wrapper.vm.isUpdating).toBe(false) // Not yet debounced

    // Fast-forward time
    vi.advanceTimersByTime(150)
    await wrapper.vm.$nextTick()

    expect(wrapper.vm.isUpdating).toBe(true)

    vi.useRealTimers()
  })

  it('displays all component types in gallery', () => {
    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    // Check for button gallery
    expect(wrapper.find('.btn-primary').exists()).toBe(true)
    expect(wrapper.find('.btn-secondary').exists()).toBe(true)
    expect(wrapper.find('.btn-danger').exists()).toBe(true)

    // Check for cards
    expect(wrapper.findAll('.card').length).toBeGreaterThan(0)

    // Check for form elements
    expect(wrapper.find('.form-input').exists()).toBe(true)
    expect(wrapper.find('.form-textarea').exists()).toBe(true)

    // Check for alerts
    expect(wrapper.find('.alert-success').exists()).toBe(true)
    expect(wrapper.find('.alert-warning').exists()).toBe(true)
    expect(wrapper.find('.alert-danger').exists()).toBe(true)
  })

  it('applies dark mode styling when toggled', async () => {
    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    await wrapper.vm.toggleColorMode()
    await wrapper.vm.$nextTick()

    const previewContent = wrapper.find('.preview-content')
    expect(previewContent.classes()).toContain('mode-dark')
  })

  it('calculates relative font sizes correctly', () => {
    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    const result = wrapper.vm.calculateRelativeSize('16px', 1.5)
    expect(result).toBe('24px')
  })

  it('adjusts colors for hover states', () => {
    const wrapper = mount(BrandingPreview, {
      props: {
        config: defaultConfig,
        organization: defaultOrganization,
      }
    })

    const adjusted = wrapper.vm.adjustColor('#3b82f6', -10)
    expect(adjusted).toMatch(/^#[0-9a-f]{6}$/i)
    expect(adjusted).not.toBe('#3b82f6') // Should be darker
  })
})
```

### Integration Tests (Pest)

**File:** `tests/Feature/Enterprise/BrandingPreviewTest.php`

```php
<?php

use App\Models\Organization;
use App\Models\User;
use App\Models\WhiteLabelConfig;
use Inertia\Testing\AssertableInertia as Assert;

it('renders branding preview in Inertia page', function () {
    $organization = Organization::factory()->create();
    $user = User::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    $config = WhiteLabelConfig::factory()->create([
        'organization_id' => $organization->id,
        'primary_color' => '#3b82f6',
        'platform_name' => 'Test Platform',
    ]);

    $this->actingAs($user)
        ->get(route('enterprise.branding', $organization))
        ->assertInertia(fn (Assert $page) => $page
            ->component('Enterprise/Organization/Branding')
            ->has('whiteLabelConfig', fn (Assert $config) => $config
                ->where('primary_color', '#3b82f6')
                ->where('platform_name', 'Test Platform')
            )
        );
});

it('includes branding configuration for preview', function () {
    $organization = Organization::factory()->create();
    $user = User::factory()->create();
    $organization->users()->attach($user, ['role' => 'admin']);

    WhiteLabelConfig::factory()->create([
        'organization_id' => $organization->id,
        'primary_color' => '#ff0000',
        'secondary_color' => '#00ff00',
        'heading_font' => 'Roboto',
    ]);

    $this->actingAs($user)
        ->get(route('enterprise.branding', $organization))
        ->assertInertia(fn (Assert $page) => $page
            ->has('whiteLabelConfig.primary_color')
            ->has('whiteLabelConfig.secondary_color')
            ->has('whiteLabelConfig.heading_font')
        );
});
```

### Browser Tests (Dusk)

```php
it('allows real-time preview of branding changes', function () {
    $this->browse(function (Browser $browser) use ($user) {
        $browser->loginAs($user)
            ->visit('/enterprise/organizations/1/branding')
            ->waitFor('.branding-preview')

            // Verify preview loads
            ->assertSee('Live Preview')
            ->assertVisible('.preview-content')

            // Change primary color
            ->type('primary_color', '#ff0000')
            ->pause(200) // Wait for debounce

            // Verify preview updates (check if buttons use new color)
            ->assertVisible('.btn-primary')

            // Switch viewport
            ->click('[data-viewport="mobile"]')
            ->pause(100)
            ->assertAttribute('.preview-container', 'style', 'width: 375px')

            // Toggle dark mode
            ->click('button[title*="dark mode"]')
            ->pause(100)
            ->assertVisible('.preview-content.mode-dark')

            // Test fullscreen
            ->click('button[title*="fullscreen"]')
            ->pause(100)
            ->assertPresent('.branding-preview.fullscreen');
    });
});
```

## Definition of Done

- [ ] BrandingPreview.vue component created with Composition API
- [ ] Real-time updates implemented with debouncing (150ms)
- [ ] CSS custom properties dynamically generated from configuration
- [ ] Component gallery includes buttons, cards, forms, alerts, typography
- [ ] All component states displayed (default, hover, active, disabled)
- [ ] Viewport switcher working (desktop, tablet, mobile)
- [ ] Color mode toggle implemented (light/dark)
- [ ] Fullscreen mode working correctly
- [ ] Screenshot capture feature implemented with html2canvas
- [ ] Logo display in header and footer
- [ ] Platform name displayed in navigation and content
- [ ] Favicon preview section included
- [ ] Accessibility contrast checker implemented
- [ ] Warning display for low contrast combinations
- [ ] Contrast ratio calculations accurate (WCAG 2.1)
- [ ] Loading overlay during updates
- [ ] Before/after comparison mode (optional)
- [ ] Responsive design on all viewports
- [ ] Integration with BrandingManager.vue parent component
- [ ] Props and events defined correctly
- [ ] Unit tests written (15+ tests, >90% coverage)
- [ ] Integration tests written
- [ ] Browser test for full workflow
- [ ] html2canvas dependency installed
- [ ] Code follows Vue 3 and Coolify patterns
- [ ] Documentation updated with usage examples
- [ ] Code reviewed and approved
- [ ] No console errors or warnings
- [ ] Performance verified (smooth updates, no lag)

## Related Tasks

- **Integrates with:** Task 5 (BrandingManager.vue parent component)
- **Displays data from:** Task 6 (ThemeCustomizer.vue color selections)
- **Shows logos from:** Task 4 (LogoUploader.vue uploaded images)
- **Uses CSS from:** Task 2 (DynamicAssetController CSS compilation)
- **Cached by:** Task 3 (Redis caching for performance)
- **Shows favicons from:** Task 7 (Favicon generation)
- **Email preview context for:** Task 9 (Email template branding)
